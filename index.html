<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8">
    <!-- ðŸš€ Preconnect to backend for faster API calls -->
    <link rel="preconnect" href="http://project.3bbddns.com:36145" crossorigin>
    <link rel="dns-prefetch" href="http://project.3bbddns.com:36145">
    
    <!-- ðŸŽ Apple-style meta tags for performance -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=5">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#8B4CB8">
    <meta name="color-scheme" content="light">
    
    <!-- Favicon with preload (served from public/) -->
    <link rel="icon" type="image/png" href="/logo.png?v=2">
    <link rel="shortcut icon" href="/logo.png?v=2">
    <link rel="apple-touch-icon" sizes="180x180" href="/logo.png?v=2">
    
    <title>PCRU-CHATBOT</title>
    
    <!-- Redirect removed: allow users to access project.3bbddns.com:36144 directly -->
    <!-- ðŸŽ¨ Preload critical CSS (render-blocking resources first) -->
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" as="style">
    
    <!-- Bootstrap 5.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- ðŸš€ Critical CSS for instant first paint -->
    <style>
      /* Prevent FOUC (Flash of Unstyled Content) */
      html { visibility: visible; opacity: 1; }

      /* Show app immediately */
      #app { visibility: visible; min-height: 100vh; }

      /* Small loading spinner while app JS loads (shows only when #app is empty) */
      #app:empty::after {
        content: '';
        position: fixed;
        top: 50%;
        left: 50%;
        width: 36px;
        height: 36px;
        margin: -18px 0 0 -18px;
        border: 3px solid rgba(139,76,184,0.16);
        border-top-color: #8B4CB8;
        border-radius: 50%;
        animation: spin 0.48s linear infinite; /* faster, snappier */
        z-index: 9999;
      }
      /* Ensure spinner hides once app renders */
      #app:not(:empty)::after { display: none !important; }
      /* Hide spinner after a short grace period even if app hasn't rendered (avoid long spinning) */
      .spinner-hidden #app:empty::after { display: none !important; }

      @keyframes spin { to { transform: rotate(360deg); } }

      /* GPU acceleration hints */
      * {
        -webkit-tap-highlight-color: transparent;
      }

      /* Smooth font rendering */
      body {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
        text-rendering: optimizeLegibility;
      }
    </style>
  </head>
  <body>
    <div id="app"></div>
    <!-- Bootstrap JS disabled to prevent auto-init errors (carousel/offsetWidth). CSS only is kept. -->
    <script type="module" src="/src/main.js"></script>
    
    <!-- ðŸŽ Performance hints for browser -->
    <script type="module">
      // Hint browser about navigation
      if ('connection' in navigator) {
        const conn = navigator.connection;
        if (conn.saveData || conn.effectiveType === 'slow-2g' || conn.effectiveType === '2g') {
          document.documentElement.classList.add('reduce-motion');
        }
      }
      // Auto-hide spinner after short grace period (600ms) so it never spins for long
      // Add fallback UI after a longer timeout when the app does not bootstrap (helps iPhone / blocked module cases)
      (function(){
        const HIDE_AFTER_MS = 600;
        const FALLBACK_MS = 3000; // show actionable help after 3s if app not mounted
        // Use Vite env VITE_PUBLIC_URL only (no hardcoded fallback). If not set, no external link will be shown.
        const PUBLIC_URL = import.meta.env.VITE_PUBLIC_URL;

        const hideTimer = setTimeout(() => document.documentElement.classList.add('spinner-hidden'), HIDE_AFTER_MS);

        // If the app mounts before fallback, cancel fallback actions
        function clearAll() {
          clearTimeout(hideTimer);
          clearTimeout(fallbackTimer);
          document.documentElement.classList.remove('spinner-hidden');
        }

        const fallbackTimer = setTimeout(() => {
          try {
            const app = document.getElementById('app');
            const isEmpty = !app || app.children.length === 0 || (app.innerHTML || '').trim().length < 20;
            if (isEmpty) {
              // hide spinner and show helpful fallback UI
              document.documentElement.classList.add('spinner-hidden');

              const existing = document.getElementById('app-fallback');
              if (!existing) {
                const fallback = document.createElement('div');
                fallback.id = 'app-fallback';
                fallback.style.cssText = 'position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:10000;padding:20px;background:rgba(0,0,0,0.6);color:#fff;flex-direction:column;text-align:center;';

                const msg = document.createElement('div');
                msg.innerText = 'à¹à¸­à¸›à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¸šà¸™à¸­à¸¸à¸›à¸à¸£à¸“à¹Œà¸™à¸µà¹‰à¹„à¸”à¹‰ à¸¥à¸­à¸‡à¹€à¸›à¸´à¸”à¹€à¸§à¸­à¸£à¹Œà¸Šà¸±à¸™à¸ªà¸²à¸˜à¸²à¸£à¸“à¸°à¸«à¸£à¸·à¸­à¸£à¸µà¹‚à¸«à¸¥à¸”à¸«à¸™à¹‰à¸²';
                msg.style.marginBottom = '12px';

                const reload = document.createElement('button');
                reload.innerText = 'à¸£à¸µà¹‚à¸«à¸¥à¸”';
                reload.style.padding = '8px 12px';
                reload.style.borderRadius = '8px';
                reload.style.border = '1px solid rgba(255,255,255,0.2)';
                reload.style.background = 'transparent';
                reload.style.color = '#fff';
                reload.onclick = function(){ location.reload() };

                const controls = document.createElement('div');
                if (PUBLIC_URL) {
                  const link = document.createElement('a');
                  link.href = PUBLIC_URL;
                  link.target = '_blank';
                  link.rel = 'noreferrer';
                  link.innerText = 'à¹€à¸›à¸´à¸”à¹€à¸§à¸­à¸£à¹Œà¸Šà¸±à¸™à¸ªà¸²à¸˜à¸²à¸£à¸“à¸°';
                  link.style.marginRight = '10px';
                  link.style.padding = '8px 12px';
                  link.style.background = '#8B4CB8';
                  link.style.color = '#fff';
                  link.style.borderRadius = '8px';
                  link.style.textDecoration = 'none';
                  controls.appendChild(link);
                }
                controls.appendChild(reload);

                fallback.appendChild(msg);
                fallback.appendChild(controls);
                document.body.appendChild(fallback);
              }
            }
          } catch(e) {
            // ignore
          }
        }, FALLBACK_MS);

        // If the app mounts or DOMContentLoaded fires, cancel fallback
        document.addEventListener('DOMContentLoaded', clearAll);
        // Also watch for a known mount signal: when #app gets children
        const observer = new MutationObserver(() => {
          const app = document.getElementById('app');
          if (app && app.children.length > 0) clearAll();
        });
        observer.observe(document.documentElement, { childList: true, subtree: true });
      })();
    </script>
  </body>
</html>
