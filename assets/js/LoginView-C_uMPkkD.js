import{I as a,r as e,f as s,e as l,C as t,c as i,o,a as n,d as r,w as d,p as u,s as c,G as v,U as p,v as b,n as m,i as h,t as g,z as f}from"./vue-vendor-CaqZERVf.js";const w={class:"login-page-wrapper"},k={class:""},y={class:"mb-3 position-relative pt-2"},x={class:"mb-3 position-relative pt-2"},L=["type"],C={key:0},I={key:1},U={key:0,class:"mb-4 col-lg-10"},A={class:"list-unstyled small"},B={class:"mb-3"},N={class:"d-grid gap-2 mb-3 col-12 col-lg-4 mx-auto mx-lg-0"},P=["disabled"],_={key:0,class:"spinner-border spinner-border-sm me-2","aria-hidden":"true"},S={role:"status"},z={class:"google-btn-container mb-4"},E=["disabled"],F={key:0,class:"spinner-border spinner-border-sm me-2","aria-hidden":"true"},G={key:1,class:"google-icon me-2",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:"24",height:"24"},M={__name:"LoginView",setup(M){const{appContext:V}=a(),{$axios:D,$swal:j}=V.config.globalProperties,q=e(""),O=e(""),T=e(""),Z=e(!1),$=e(!1),H=e(null),J=e(null),R=e(!1),Y=s(),K=e({has8Chars:!1,hasUppercase:!1,hasNumber:!1});async function Q(){$.value=!0;try{const a=await D.get("/auth/google/url.php");a.data&&a.data.url?window.location.href=a.data.url:ea("error","ไม่สามารถเชื่อมต่อกับ Google ได้")}catch(a){ea("error","เกิดข้อผิดพลาดในการLog in withGoogle")}finally{$.value=!1}}async function W(){const a=T.value;if(J.value&&J.value.classList.remove("is-invalid"),!1===a.checkValidity())return a.classList.add("was-validated"),void(R.value=!0);if(!K.value.hasUppercase||!K.value.hasNumber)return J.value&&J.value.classList.add("is-invalid"),a.classList.add("was-validated"),void(R.value=!0);a.classList.remove("was-validated"),Z.value=!0,R.value=!1,H.value&&H.value.classList.remove("is-invalid");try{const a={id:q.value,password:O.value},e=await D.post("/login",a);if(e.data&&"No User"===e.data.usertype)return H.value&&H.value.classList.add("is-invalid"),J.value&&J.value.classList.add("is-invalid"),void(R.value=!0);e.data&&e.data.token?(localStorage.setItem("userToken",e.data.token),localStorage.setItem("userType",e.data.usertype),localStorage.setItem("userInfo",JSON.stringify(e.data.userInfo)),ea("success","Login Successful!"),Y.push({path:"/dashboard"}),R.value=!1):(H.value&&H.value.classList.add("is-invalid"),J.value&&J.value.classList.add("is-invalid"),R.value=!0)}catch(e){H.value&&H.value.classList.add("is-invalid"),J.value&&J.value.classList.add("is-invalid"),R.value=!0}finally{Z.value=!1}}l(O,a=>{K.value.has8Chars=a.length>=8,K.value.hasUppercase=/[A-Z]/.test(a),K.value.hasNumber=/\d/.test(a),R.value});const X=e("password");function aa(){X.value="password"===X.value?"text":"password"}const ea=(a,e)=>{j.fire({toast:!0,icon:a,title:e,position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})};return(a,e)=>{const s=t("router-link");return o(),i("div",w,[n(s,{to:"/",class:"apple-back-btn"},{default:d(()=>[...e[4]||(e[4]=[r("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2.5","stroke-linecap":"round","stroke-linejoin":"round"},[r("polyline",{points:"15 18 9 12 15 6"})],-1),r("span",null,"Back",-1)])]),_:1}),r("form",{ref_key:"loginForm",ref:T,onSubmit:f(W,["prevent"]),class:"needs-validation",novalidate:""},[r("div",k,[e[18]||(e[18]=r("header",{class:"fs-1 fw-bold mb-4 text-center text-lg-start"}," Login ",-1)),r("div",y,[c(r("input",{ref_key:"idInput",ref:H,type:"number",name:"ID",class:"form-control border-dark border-2 rounded-3 pt-3",id:"floatingInput",placeholder:"","onUpdate:modelValue":e[0]||(e[0]=a=>q.value=a),required:"",onInput:e[1]||(e[1]=a=>H.value.classList.remove("is-invalid"))},null,544),[[v,q.value]]),e[5]||(e[5]=r("label",{class:"fw-bold position-absolute top-0 ms-2 bg-light rounded-3 px-2 mb-0",for:"floatingInput"},"ID",-1)),e[6]||(e[6]=r("div",{class:"invalid-feedback"}," Please provide a valid ID ",-1))]),r("div",x,[c(r("input",{ref_key:"passwordInput",ref:J,type:X.value,name:"password",class:"form-control border-dark border-2 rounded-3 pt-3 pe-5",id:"floatingPassword",placeholder:"","onUpdate:modelValue":e[2]||(e[2]=a=>O.value=a),required:"",minlength:"8",onInput:e[3]||(e[3]=a=>O.value.length>=8&&J.value.classList.remove("is-invalid"))},null,40,L),[[p,O.value]]),e[9]||(e[9]=r("label",{class:"fw-bold position-absolute top-0 ms-2 bg-light rounded-3 px-2 mb-0",for:"floatingPassword"},"Password",-1)),c(r("button",{type:"button",onClick:aa,class:"btn btn-sm btn-link text-muted position-absolute end-0 top-0 mt-3 pt-1 me-2"},["password"===X.value?(o(),i("span",C,[...e[7]||(e[7]=[r("i",{class:"bi bi-eye fs-5"},null,-1)])])):(o(),i("span",I,[...e[8]||(e[8]=[r("i",{class:"bi bi-eye-slash fs-5"},null,-1)])]))],512),[[b,K.value.has8Chars&&!J.value?.classList.contains("is-invalid")]]),e[10]||(e[10]=r("div",{class:"invalid-feedback"}," Please provide a password (min 8 characters, at least one uppercase, at least one number) ",-1))]),R.value?(o(),i("div",U,[e[14]||(e[14]=r("p",{class:"mb-1 text-center text-lg-start"},"Your password must have:",-1)),r("ul",A,[r("li",{class:m({"text-success":K.value.has8Chars})},[r("i",{class:m(["bi me-1",K.value.has8Chars?"bi-check-circle-fill":"bi-circle"])},null,2),e[11]||(e[11]=h(" At least 8 characters ",-1))],2),r("li",{class:m({"text-success":K.value.hasUppercase})},[r("i",{class:m(["bi me-1",K.value.hasUppercase?"bi-check-circle-fill":"bi-circle"])},null,2),e[12]||(e[12]=h(" At least one uppercase letter (A-Z) ",-1))],2),r("li",{class:m({"text-success":K.value.hasNumber})},[r("i",{class:m(["bi me-1",K.value.hasNumber?"bi-check-circle-fill":"bi-circle"])},null,2),e[13]||(e[13]=h(" At least one number (0-9) ",-1))],2)])])):u("",!0),r("div",B,[n(s,{to:"/forgotpassword",class:"fw-bold text-dark"},{default:d(()=>[...e[15]||(e[15]=[h("Forgot password",-1)])]),_:1})]),r("div",N,[r("button",{type:"submit",class:"btn rounded-3 fw-bold py-3 px-5 mt-4 fs-5 text-nowrap",style:{"background-color":"#E3E3E3"},disabled:Z.value},[Z.value?(o(),i("span",_)):u("",!0),r("span",S,g(Z.value?"Logging in...":"Login"),1)],8,P)]),e[19]||(e[19]=r("div",{class:"divider-with-text mb-3"},[r("span",null,"OR")],-1)),r("div",z,[r("button",{type:"button",class:"btn btn-google rounded-3",onClick:Q,disabled:$.value},[$.value?(o(),i("span",F)):(o(),i("svg",G,[...e[16]||(e[16]=[r("path",{fill:"#EA4335",d:"M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"},null,-1),r("path",{fill:"#4285F4",d:"M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"},null,-1),r("path",{fill:"#FBBC05",d:"M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"},null,-1),r("path",{fill:"#34A853",d:"M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"},null,-1)])])),e[17]||(e[17]=r("span",{class:"google-btn-text"},"Log in withGoogle",-1))],8,E)])])],544)])}}};export{M as default};
