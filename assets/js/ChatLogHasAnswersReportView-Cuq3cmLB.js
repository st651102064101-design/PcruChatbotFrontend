import{I as a,r as e,e as s,l as t,g as l,H as i,c as n,o,d as r,i as c,t as u,p as d,a as p,u as v,s as m,G as g,F as h,b,n as y,z as f,L as w,f as T,h as C}from"./vue-vendor-CaqZERVf.js";import{_ as x,A as k,f as A,T as L,b as D,i as I,S as O,c as S,a as M}from"./index-CjxO0-0y.js";import{B as Q}from"./index-DlWMEZ1A.js";import{c as q,W as j}from"./dashboard-styles-CiicuUba.js";import{C as U,r as _}from"./chart-CicJT4lR.js";import"./axios-vendor-Dos3PyFQ.js";const F={class:"dashboard-container"},H={class:"container-fluid pt-2 px-4 pb-5"},R={key:0,class:"text-center py-5 fade-in"},E={key:1,class:"alert apple-alert-danger mx-auto",role:"alert"},P={key:2,class:"fade-in-up",style:{"animation-delay":"0.1s"}},B={class:"row mb-4 g-3"},V={class:"col-md-4"},G={class:"apple-stat-card"},N={class:"stat-content"},W={class:"stat-value"},z={class:"col-md-4"},Z={class:"apple-stat-card"},$={class:"stat-content"},J={class:"stat-value"},K={class:"col-md-4"},X={class:"apple-stat-card"},Y={class:"stat-content"},aa=["title"],ea={key:0,class:"row mb-4"},sa={class:"col-12"},ta={class:"apple-card chart-card"},la={class:"chart-area w-100"},ia={class:"apple-card table-wrapper"},na={class:"card-header-actions p-3 d-flex justify-content-between align-items-center"},oa={class:"apple-counter-capsule"},ra={class:"count"},ca={class:"search-container"},ua={class:"table-responsive"},da={class:"table apple-table mb-0"},pa={class:"ps-4 fw-medium text-secondary","data-label":"ID"},va={class:"py-3","data-label":"เวลา"},ma=["title"],ga={class:"py-3","data-label":"คำถาม"},ha={class:"text-dark fw-medium"},ba={class:"py-3","data-label":"คำตอบที่ตรงกัน"},ya={class:"text-secondary small"},fa={key:0},wa={class:"pagination-footer"},Ta={class:"pagination-info"},Ca={"aria-label":"Page navigation"},xa={class:"pagination pagination-sm mb-0 align-items-center"},ka=["onClick"],Aa=x({__name:"ChatLogHasAnswersReport",props:{questionsTitleMap:{type:Object,default:()=>({})},chartOptions:Object,barChartOptions:Object},emits:["ws-status"],setup(T,{emit:C}){U.register(..._);const x=T,D=C,{appContext:I}=a(),O=I.config.globalProperties.$axios,S=e([]),M=e(!0),Aa=e(null),La=e(!1);let Da=null;const Ia=e("");s(Ia,()=>{Ra.value=1});const Oa=e({sortBy:"date",sortOrder:"desc",datePreset:"all",dateFrom:"",dateTo:""}),Sa=[{value:"date",label:"วันที่"},{value:"id",label:"รหัส"},{value:"query",label:"คำถาม"}];function Ma(){Ra.value=1}function Qa(a){if(!a)return"-";const e=new Date(a);return isNaN(e.getTime())?a:e.toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric"})}s(Oa,()=>{Ra.value=1},{deep:!0});const qa=t(()=>{const a=(new Date).toISOString().slice(0,10);return S.value.filter(e=>e.Timestamp&&e.Timestamp.startsWith(a)).length}),ja=t(()=>{if(0===S.value.length)return"-";const a={};S.value.forEach(e=>{const s=x.questionsTitleMap[e.QuestionsAnswersID]||e.QuestionsAnswersID||"Unknown";a[s]=(a[s]||0)+1});const e=Object.entries(a).sort((a,e)=>e[1]-a[1]);return e.length>0?e[0][0]:"-"}),Ua=t(()=>{let a=Array.isArray(S.value)?S.value:[];if(Oa.value.dateFrom){const e=new Date(Oa.value.dateFrom);e.setHours(0,0,0,0),a=a.filter(a=>!!a.Timestamp&&new Date(a.Timestamp)>=e)}if(Oa.value.dateTo){const e=new Date(Oa.value.dateTo);e.setHours(23,59,59,999),a=a.filter(a=>!!a.Timestamp&&new Date(a.Timestamp)<=e)}const e=(Ia.value||"").toString().trim().toLowerCase();return e&&(a=a.filter(a=>{const s=null!=a.ChatLogID?String(a.ChatLogID).toLowerCase():"",t=a.Timestamp?String(a.Timestamp).toLowerCase():"",l=a.UserQuery?String(a.UserQuery).toLowerCase():"",i=x.questionsTitleMap&&x.questionsTitleMap[a.QuestionsAnswersID]?String(x.questionsTitleMap[a.QuestionsAnswersID]).toLowerCase():null!=a.QuestionsAnswersID?String(a.QuestionsAnswersID).toLowerCase():"";return s.includes(e)||t.includes(e)||l.includes(e)||i.includes(e)})),a}),_a=t(()=>{const a=Ua.value.slice(),{sortBy:e,sortOrder:s}=Oa.value,t="asc"===s?1:-1;return a.sort((a,s)=>{let l=0;if("date"===e){l=(a?.Timestamp?new Date(a.Timestamp).getTime():0)-(s?.Timestamp?new Date(s.Timestamp).getTime():0)}else"id"===e?l=(a?.ChatLogID||0)-(s?.ChatLogID||0):"query"===e&&(l=(a?.UserQuery||"").localeCompare(s?.UserQuery||"","th"));return l*t})}),Fa=async()=>{M.value=!0,Aa.value=null;try{const a=await O.get("/getChatLogHasAnswers");S.value=a.data?.data||a.data||[]}catch(a){Aa.value=a.response?.data?.message||a.message||"Failed to load data."}finally{M.value=!1}},Ha=t(()=>(Array.isArray(S.value)?S.value:[]).length),Ra=e(1),Ea=e(5),Pa=t(()=>_a.value.length),Ba=t(()=>Math.max(1,Math.ceil(Pa.value/Ea.value))),Va=t(()=>0===Pa.value?0:(Ra.value-1)*Ea.value+1),Ga=t(()=>0===Pa.value?0:Math.min(Ra.value*Ea.value,Pa.value)),Na=t(()=>{const a=(Ra.value-1)*Ea.value;return _a.value.slice(a,a+Ea.value)}),Wa=t(()=>{const a=Ba.value,e=Ra.value;return a<=4?Array.from({length:a},(a,e)=>e+1):e<=2?[1,2,3,4]:e>=a-1?[a-3,a-2,a-1,a]:[e-1,e,e+1,e+2]});function za(a){a>=1&&a<=Ba.value&&(Ra.value=a)}function Za(){za(Math.max(1,Ra.value-1))}function $a(){za(Math.min(Ba.value,Ra.value+1))}function Ja(){za(1)}function Ka(){za(Ba.value)}const Xa=()=>{w(()=>{[...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map(a=>new L(a))})};s(Na,()=>{Xa()});const Ya=t(()=>{const a=Array.isArray(S.value)?S.value:[],e={};a.forEach(a=>{const s=a.QuestionsAnswersID,t=x.questionsTitleMap&&x.questionsTitleMap[s]?x.questionsTitleMap[s]:null!=s?String(s):"Unknown";e[t]=(e[t]||0)+1});const s=Object.keys(e),t=Object.values(e),l=["#0071e3","#34C759","#FF9500","#FF3B30","#5856D6","#AF52DE"];return{labels:s,datasets:[{label:"Chat Logs",data:t,backgroundColor:s.map((a,e)=>l[e%l.length]),borderRadius:4}]}}),ae=t(()=>({responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,grid:{borderDash:[4,4],color:"#f0f0f0"},ticks:{precision:0}},x:{grid:{display:!1}}},plugins:{legend:{display:!1}}}));return l(()=>{Fa(),Xa(),Da=q(j.CHAT_LOGS,{axios:O,onMessage:a=>{const e=a?.data?.action||a?.action||"",s=a?.type||"";(e||"CHATLOG_UPDATE"===s||"CHATLOGS_UPDATE"===s)&&Fa()},onOpen:()=>{La.value=!0,D("ws-status",!0)},onClose:()=>{La.value=!1,D("ws-status",!1)}})}),i(()=>{Da&&Da.disconnect()}),(a,e)=>(o(),n("div",F,[r("div",H,[M.value?(o(),n("div",R,[...e[3]||(e[3]=[r("div",{class:"apple-spinner"},null,-1),r("p",{class:"mt-3 text-secondary"},"Loading chat logs...",-1)])])):Aa.value?(o(),n("div",E,[e[4]||(e[4]=r("i",{class:"bi bi-exclamation-circle-fill me-2"},null,-1)),c(" "+u(Aa.value),1)])):(o(),n("div",P,[r("div",B,[r("div",V,[r("div",G,[e[6]||(e[6]=r("div",{class:"stat-icon-wrapper blue-gradient"},[r("i",{class:"bi bi-collection"})],-1)),r("div",N,[r("div",W,u(Pa.value),1),e[5]||(e[5]=r("div",{class:"stat-label"},"Total Logs",-1))])])]),r("div",z,[r("div",Z,[e[8]||(e[8]=r("div",{class:"stat-icon-wrapper green-gradient"},[r("i",{class:"bi bi-calendar-check"})],-1)),r("div",$,[r("div",J,u(qa.value),1),e[7]||(e[7]=r("div",{class:"stat-label"},"Today",-1))])])]),r("div",K,[r("div",X,[e[10]||(e[10]=r("div",{class:"stat-icon-wrapper orange-gradient"},[r("i",{class:"bi bi-star-fill"})],-1)),r("div",Y,[r("div",{class:"stat-value text-truncate",style:{"max-width":"200px"},title:ja.value},u(ja.value),9,aa),e[9]||(e[9]=r("div",{class:"stat-label"},"Top Question",-1))])])])]),Ha.value>0?(o(),n("div",ea,[r("div",sa,[r("div",ta,[e[11]||(e[11]=r("div",{class:"card-header-clean"},[r("h5",null,"Frequent Questions")],-1)),r("div",la,[p(v(Q),{"chart-data":Ya.value,"chart-options":ae.value,style:{height:"260px"}},null,8,["chart-data","chart-options"])])])])])):d("",!0),r("div",ia,[r("div",na,[r("div",oa,[e[12]||(e[12]=r("span",{class:"label"},"Logs",-1)),e[13]||(e[13]=r("span",{class:"separator"},"|",-1)),r("span",ra,u(Pa.value),1)]),r("div",ca,[e[15]||(e[15]=r("i",{class:"bi bi-search search-icon"},null,-1)),m(r("input",{type:"text",class:"search-input",placeholder:"Search logs...","onUpdate:modelValue":e[0]||(e[0]=a=>Ia.value=a)},null,512),[[g,Ia.value]]),Ia.value?(o(),n("button",{key:0,class:"search-clear",onClick:e[1]||(e[1]=a=>Ia.value="")},[...e[14]||(e[14]=[r("i",{class:"bi bi-x-circle-fill"},null,-1)])])):d("",!0)])]),p(k,{class:"px-3",modelValue:Oa.value,"onUpdate:modelValue":e[2]||(e[2]=a=>Oa.value=a),"show-sort":!0,"sort-options":Sa,"default-sort-by":"date","default-sort-order":"desc","show-date-presets":!0,"show-date-range":!0,onChange:Ma},null,8,["modelValue"]),r("div",ua,[r("table",da,[e[18]||(e[18]=r("thead",null,[r("tr",null,[r("th",{class:"ps-4"},"ID"),r("th",null,"Timestamp"),r("th",null,"User Query"),r("th",null,"Matched Question")])],-1)),r("tbody",null,[(o(!0),n(h,null,b(Na.value,a=>(o(),n("tr",{key:a.ChatLogID,class:"align-middle apple-row"},[r("td",pa,u(a.ChatLogID),1),r("td",va,[r("span",{class:"apple-badge-gray","data-bs-toggle":"tooltip","data-bs-placement":"top",title:Qa(a.Timestamp)},u(v(A)(a.Timestamp)),9,ma)]),r("td",ga,[r("div",ha,u(a.UserQuery),1)]),r("td",ba,[r("div",ya,[e[16]||(e[16]=r("i",{class:"bi bi-arrow-return-right me-1"},null,-1)),c(" "+u(T.questionsTitleMap[a.QuestionsAnswersID]||a.QuestionsAnswersID),1)])])]))),128)),0===Ua.value.length?(o(),n("tr",fa,[...e[17]||(e[17]=[r("td",{colspan:"4",class:"text-center text-muted py-5"},[r("div",{class:"empty-state"},[r("i",{class:"bi bi-search"}),r("p",null,"No chat logs found")])],-1)])])):d("",!0)])])]),r("div",wa,[r("div",Ta," แสดง "+u(Va.value)+" - "+u(Ga.value)+" จาก "+u(Pa.value)+" รายการ ",1),r("nav",Ca,[r("ul",xa,[r("li",{class:y(["page-item",{disabled:1===Ra.value}])},[r("a",{class:"page-link",href:"#",onClick:f(Ja,["prevent"])},"«")],2),r("li",{class:y(["page-item",{disabled:1===Ra.value}])},[r("a",{class:"page-link",href:"#",onClick:f(Za,["prevent"])},"‹")],2),(o(!0),n(h,null,b(Wa.value,a=>(o(),n("li",{key:a,class:y(["page-item",{active:Ra.value===a}])},[r("a",{class:"page-link page-num",href:"#",onClick:f(e=>za(a),["prevent"])},u(a),9,ka)],2))),128)),r("li",{class:y(["page-item",{disabled:Ra.value===Ba.value||0===Ba.value}])},[r("a",{class:"page-link",href:"#",onClick:f($a,["prevent"])},"›")],2),r("li",{class:y(["page-item",{disabled:Ra.value===Ba.value||0===Ba.value}])},[r("a",{class:"page-link",href:"#",onClick:f(Ka,["prevent"])},"»")],2)])])])])]))])]))}},[["__scopeId","data-v-3f09427f"]]),La={class:"report-page-container"},Da={class:"main-content flex-grow-1"},Ia={class:"apple-dashboard"},Oa={class:"dashboard-hero"},Sa={class:"hero-content"},Ma=["aria-label"],Qa={class:"hero-status"},qa={class:"reports-grid"},ja=x({__name:"ChatLogHasAnswersReportView",setup(s){U.register(..._);const c=T(),{appContext:m}=a(),{$axios:g}=m.config.globalProperties,h=e({}),b=e(""),w=e([]),x=e(!1);let k=null;const A=a=>{x.value=a},L=()=>{const a=document.querySelector(".sidebar");!I.value?(k=M.value,M.value=!1,a&&a.classList.remove("collapsed"),document.body.classList.add("sidebar-open"),document.body.classList.add("sidebar-mobile-expanded"),I.value=!0):(M.value=!!k,a&&k&&a.classList.add("collapsed"),document.body.classList.remove("sidebar-open"),document.body.classList.remove("sidebar-mobile-expanded"),I.value=!1,k=null)},Q=e({responsive:!0,maintainAspectRatio:!1,cutout:"65%",plugins:{legend:{position:"right"},tooltip:{cornerRadius:12}}}),q=e({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0},x:{grid:{display:!1}}},borderRadius:8}),j=t(()=>{const a={};return w.value.forEach(e=>{a[e.QuestionsAnswersID]=e.QuestionTitle}),a});let F=null;return l(()=>{F=D();const a=localStorage.getItem("userToken"),e=localStorage.getItem("userType"),s=localStorage.getItem("userInfo");if(a){if(e&&(b.value=e),s)try{h.value=JSON.parse(s)}catch(t){}(async()=>{try{const a=await g.get("/questionsanswers");w.value=Array.isArray(a.data)?a.data:a.data?.data||[]}catch(a){}})()}else c.replace({name:"login"})}),i(()=>{"function"==typeof F&&F(),I.value=!1,document.body.classList.remove("sidebar-open"),document.body.classList.remove("sidebar-mobile-expanded")}),(a,e)=>(o(),n("div",La,[p(O,{userType:b.value,userInfoObject:h.value},null,8,["userType","userInfoObject"]),v(I)?(o(),n("div",{key:0,class:"mobile-sidebar-backdrop",onClick:L,"aria-hidden":"true"})):d("",!0),r("main",Da,[r("div",Ia,[r("div",Oa,[r("div",Sa,[r("button",{class:"mobile-sidebar-toggle mobile-inline-toggle",onClick:f(L,["stop"]),"aria-label":v(I)?"Close sidebar":"Open sidebar"},[p(S,{isOpen:v(I)},null,8,["isOpen"])],8,Ma),e[0]||(e[0]=C('<div class="hero-heading" data-v-1c431455><div class="hero-icon apple-icon-box indigo-gradient" data-v-1c431455><svg class="chat-icon" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" data-v-1c431455><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z" data-v-1c431455></path><path d="M9 10h6m-6 4h4" data-v-1c431455></path></svg></div><div class="hero-text" data-v-1c431455><h3 class="page-title m-0" data-v-1c431455>Chat Logs (Has Answers)</h3><span class="text-secondary small" data-v-1c431455>User queries matched with answers</span></div></div>',1))]),r("div",Qa,[r("div",{class:y(["apple-status-badge",{online:x.value}])},[e[1]||(e[1]=r("span",{class:"status-dot"},null,-1)),r("span",null,u(x.value?"Live":"Offline"),1)],2)])]),r("div",qa,[p(Aa,{questionsTitleMap:j.value,chartOptions:Q.value,barChartOptions:q.value,onWsStatus:A},null,8,["questionsTitleMap","chartOptions","barChartOptions"])])])])]))}},[["__scopeId","data-v-1c431455"]]);export{ja as default};
