import{f as e,k as a,r as l,e as t,l as s,g as n,P as i,c as r,o,d as u,m as d,a as c,t as v,p,i as b,s as m,G as g,F as k,b as f,n as y,u as w,z as h,w as C,K as F,D as x,q as D,x as T,L as I,I as S,H as L,h as V}from"./vue-vendor-CaqZERVf.js";import{_ as q,u as A,A as R,f as U,d as Q,b as _,S as O,i as M,c as N,a as B}from"./index-YNQFrYK5.js";import"./auto-oB3XP6c3.js";import{c as P,W as E}from"./dashboard-styles-DF6dX7li.js";import{C as j,r as K}from"./chart-CicJT4lR.js";import"./axios-vendor-Dos3PyFQ.js";const H={class:""},W={class:"card p-4 bg-light shadow-sm mb-4 rounded-4"},z={key:0,class:"text-center py-3"},$={key:1,class:"alert alert-danger",role:"alert"},Z={key:2},G={key:0,class:"mb-3"},J={class:"alert alert-info py-2 px-3 small mb-0"},X={key:1,class:"row mb-4"},Y={class:"col-md-6"},ee={class:"chart-container"},ae={class:"col-md-6"},le={class:"chart-container"},te={class:"d-flex flex-wrap justify-content-between align-items-center mb-2 gap-2"},se={class:"small text-muted"},ne={class:"search-container"},ie={class:"table-responsive"},re={class:"table table-striped table-hover feedbacks-table"},oe=["onClick"],ue={"data-label":"ID"},de={"data-label":"สถานะ"},ce={key:3},ve={"data-label":"เวลา"},pe={"data-label":"คำถามผู้ใช้"},be=["title"],me={"data-label":"คำตอบ"},ge=["title"],ke={"data-label":"เหตุผล"},fe={key:1,class:"text-muted"},ye={"data-label":"ความคิดเห็น"},we={key:0,class:"comment-cell"},he=["onClick"],Ce={class:"comment-preview"},Fe={key:1,class:"text-muted"},xe={key:0},De={class:"d-flex justify-content-between align-items-center p-3 border-top mt-2"},Te={class:"small text-muted"},Ie={"aria-label":"Page navigation for feedbacks"},Se={class:"pagination pagination-sm mb-0 align-items-center"},Le=["onClick"],Ve={class:"apple-modal-content wide-modal"},qe={class:"apple-modal-body"},Ae={key:0,class:"text-center py-5"},Re={key:1,class:"apple-form-container"},Ue={class:"apple-input-group"},Qe={class:"apple-input-group"},_e={class:"row g-3"},Oe={class:"col-md-6"},Me={class:"apple-input-group"},Ne={class:"col-md-6"},Be={class:"apple-input-group"},Pe={class:"select-wrapper"},Ee=["value","disabled"],je={class:"apple-input-group"},Ke={class:"keyword-input-wrapper"},He=["onKeyup"],We={class:"d-flex flex-wrap gap-2 mt-2"},ze=["onClick"],$e={class:"apple-actions"},Ze=["disabled"],Ge=["disabled"],Je={key:0,class:"spinner-border spinner-border-sm me-2"},Xe={class:"comment-modal-content"},Ye={class:"comment-modal-body"},ea={class:"comment-metadata"},aa={class:"comment-meta-item"},la={class:"comment-meta-value"},ta={key:0,class:"comment-meta-item"},sa={class:"comment-text-container"},na={class:"comment-full-text"},ia={class:"alert-modal-content"},ra={class:"alert-modal-header"},oa={class:"alert-modal-title"},ua={class:"alert-modal-body"},da=["innerHTML"],ca={key:0,class:"alert-modal-footer"},va={key:1,class:"alert-modal-footer"},pa={class:"drawer-body"},ba={class:"drawer-section"},ma={class:"drawer-value text-secondary"},ga={class:"drawer-section"},ka={class:"drawer-value"},fa={key:0,class:"d-flex align-items-center gap-2"},ya={key:1,class:"d-flex align-items-center gap-2"},wa={key:2,class:"d-flex align-items-center gap-2"},ha={key:3,class:"text-muted"},Ca={class:"drawer-section"},Fa={class:"drawer-value d-flex align-items-center gap-2"},xa={class:"text-muted small"},Da={class:"drawer-section"},Ta={class:"drawer-value text-dark whitespace-prewrap"},Ia={class:"drawer-section"},Sa={class:"drawer-value text-dark whitespace-prewrap"},La={key:0,class:"drawer-section"},Va={class:"mt-2"},qa={key:1,class:"drawer-section"},Aa={class:"drawer-value text-dark whitespace-prewrap comment-text-box"},Ra={class:"drawer-footer"},Ua={class:"d-flex gap-2"},Qa=["disabled"],_a=["disabled"],Oa={key:0,class:"spinner-border spinner-border-sm me-1"},Ma={key:1,class:"bi bi-trash me-2"},Na=q({__name:"FeedbacksReport",props:{feedbacks:{type:Array,default:()=>[]},feedbacksLoading:{type:Boolean,default:!1},feedbacksError:{type:[String,null],default:null},showLiveBadge:{type:Boolean,default:!0}},emits:["refresh"],setup(S,{emit:L}){const V=e(),q=a(),_=l(q.query?.questionId?String(q.query.questionId):""),O=S,M=L,N=l(!1);let B=null;const K=Q,{success:Na,error:Ba,info:Pa}=A(),Ea=l("");t(Ea,()=>{Ja.value=1});const ja=s(()=>Array.isArray(O.feedbacks)?O.feedbacks:[]),Ka=l({sortBy:"date",sortOrder:"desc",status:"",datePreset:"all",dateFrom:"",dateTo:""});q.query?.status&&(Ka.value.status=q.query.status),t(()=>q.query,e=>{_.value=e?.questionId?String(e.questionId):"",e?.status&&(Ka.value.status=e.status)});const Ha=[{value:"date",label:"วันที่"},{value:"id",label:"รหัส"},{value:"type",label:"ประเภท"}],Wa=[{value:"unlike",label:"Unlike",icon:"bi bi-hand-thumbs-down-fill",color:"danger"},{value:"like",label:"Like",icon:"bi bi-hand-thumbs-up-fill",color:"success"},{value:"pending",label:"Pending",icon:"bi bi-hourglass-split",color:"warning"}];function za(e){Ja.value=1}function $a(e){const a=(e??"").toString().toLowerCase().trim();return"0"===a||"unlike"===a||"false"===a}s(()=>Ka.value.status||"all");const Za=s(()=>{let e=ja.value;_.value&&(e=e.filter(e=>String(e?.QuestionsAnswersID||"")===String(_.value)));const a=Ka.value.status||"all";if("like"===a?e=e.filter(e=>function(e){const a=(e??"").toString().toLowerCase().trim();return"1"===a||"like"===a||"true"===a}(e?.FeedbackValue)):"unlike"===a?e=e.filter(e=>$a(e?.FeedbackValue)):"pending"===a&&(e=e.filter(e=>function(e){const a=(e??"").toString().toLowerCase().trim();return"2"===a||"pending"===a}(e?.FeedbackValue))),Ka.value.dateFrom){const a=new Date(Ka.value.dateFrom);a.setHours(0,0,0,0),e=e.filter(e=>!!e.Timestamp&&new Date(e.Timestamp)>=a)}if(Ka.value.dateTo){const a=new Date(Ka.value.dateTo);a.setHours(23,59,59,999),e=e.filter(e=>!!e.Timestamp&&new Date(e.Timestamp)<=a)}const l=(Ea.value||"").toString().trim().toLowerCase();return l?e.filter(e=>String(e.FeedbackID||"").toLowerCase().includes(l)||null!=e.FeedbackValue&&String(e.FeedbackValue).toLowerCase().includes(l)||e.UserQuery&&String(e.UserQuery).toLowerCase().includes(l)||e.QuestionText&&String(e.QuestionText).toLowerCase().includes(l)||e.FeedbackReason&&String(e.FeedbackReason).toLowerCase().includes(l)||e.FeedbackComment&&String(e.FeedbackComment).toLowerCase().includes(l)||e.Timestamp&&String(e.Timestamp).toLowerCase().includes(l)):e});t(Ka,()=>{Ja.value=1},{deep:!0});const Ga=s(()=>(Array.isArray(O.feedbacks)?O.feedbacks:[]).length),Ja=l(1),Xa=l(5),Ya=s(()=>Za.value.length),el=s(()=>Math.max(1,Math.ceil(Ya.value/Xa.value))),al=s(()=>0===Ya.value?0:(Ja.value-1)*Xa.value+1),ll=s(()=>0===Ya.value?0:Math.min(Ja.value*Xa.value,Ya.value)),tl=s(()=>{const e=Za.value.slice(),{sortBy:a,sortOrder:l}=Ka.value,t="asc"===l?1:-1;return e.sort((e,l)=>{let s=0;if("date"===a){s=(e?.Timestamp?new Date(e.Timestamp).getTime():0)-(l?.Timestamp?new Date(l.Timestamp).getTime():0)}else if("id"===a)s=(e?.FeedbackID||0)-(l?.FeedbackID||0);else if("type"===a){s=($a(e?.FeedbackValue)?1:0)-($a(l?.FeedbackValue)?1:0)}return s*t})}),sl=s(()=>{const e=(Ja.value-1)*Xa.value;return tl.value.slice(e,e+Xa.value)}),nl=s(()=>{const e=el.value,a=Ja.value;return e<=4?Array.from({length:e},(e,a)=>a+1):a<=2?[1,2,3,4]:a>=e-1?[e-3,e-2,e-1,e]:[a-1,a,a+1,a+2]});function il(e){e>=1&&e<=el.value&&(Ja.value=e)}function rl(){il(Math.max(1,Ja.value-1))}function ol(){il(Math.min(el.value,Ja.value+1))}function ul(){il(1)}function dl(){il(el.value)}const cl={wrong_answer:"คำตอบไม่ถูกต้อง",incomplete:"ข้อมูลไม่ครบถ้วน",outdated:"ข้อมูลล้าสมัย",not_relevant:"ไม่เกี่ยวข้องกับคำถาม",confusing:"เข้าใจยาก/สับสน",too_long:"ยาวเกินไป",too_short:"สั้นเกินไป",wrong_format:"รูปแบบไม่ถูกต้อง",missing_details:"ขาดรายละเอียดสำคัญ",other:"อื่นๆ"};function vl(e){return cl[e]||e}function pl(e){return{wrong_answer:"reason-wrong",incomplete:"reason-incomplete",outdated:"reason-outdated",not_relevant:"reason-irrelevant",confusing:"reason-confusing",other:"reason-other"}[e]||"reason-default"}function bl(e,a=50){return e?e.length>a?e.substring(0,a)+"...":e:""}const ml=l(!1),gl=l(null);function kl(){ml.value=!1,setTimeout(()=>{gl.value=null},300)}const fl=l(!1),yl=l(null);function wl(){fl.value=!1,setTimeout(()=>{yl.value=null},300)}function hl(e){if(!e)return"-";const a=new Date(e);return isNaN(a.getTime())?e:a.toLocaleString("th-TH",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function Cl(){yl.value&&(wl(),async function(e){if(!e?.FeedbackID||!e?.QuestionsAnswersID)return;$l.value=e.FeedbackID,Gl.value=!0,Jl.value=!0,tt.value=e,st();try{await async function(){try{const e=await K.get("/questionsanswers/categories");Yl.value=e.data?.data||e.data||[]}catch(e){Yl.value=[]}}();const a=await async function(e){const a=await K.get("/questionsanswers");Array.isArray(a.data),a.data;const l=Array.isArray(a.data)?a.data:a.data?.data||[];return l.find(a=>String(a.QuestionsAnswersID)===String(e))||null}(e.QuestionsAnswersID);if(!a)return await Ll({message:"ไม่พบคำถาม/คำตอบสำหรับ Feedback นี้",type:"error"}),void nt();const l=(e=>{if(!e)return"";const a=String(e),l=Yl.value.find(e=>String(e.CategoriesID)===a);if(l)return l.CategoriesID;const t=Yl.value.find(e=>String(e.CategoriesName)===a);return t?t.CategoriesID:""})(a.CategoriesID||a.CategoryID||a.categoriesId||a.categoryId||a.CategoriesName||a.CategoryName);lt.value.questionTitle=a.QuestionTitle||"",lt.value.questionText=a.QuestionText||"",lt.value.reviewDate=a.ReviewDate?new Date(a.ReviewDate).toISOString().slice(0,10):(new Date).toISOString().slice(0,10),lt.value.categoriesId=l?String(l):"",lt.value.keywords=(a.keywords||[]).map(e=>e.KeywordText||e)}catch(a){await Ll({message:"โหลดข้อมูลไม่สำเร็จ",type:"error"}),nt()}finally{Jl.value=!1,$l.value=null}}(yl.value))}async function Fl(){yl.value&&(wl(),await async function(e){if(!e?.FeedbackID)return;if(null!=e.FeedbackValue&&0!==Number(e.FeedbackValue)){const e="Feedback cannot be marked as handled (already handled or unsupported feedback type).";return Ba(e),void(await Ll({message:e,type:"error"}))}if(!(await function({title:e="",message:a=""}={}){return Tl.value=e||"ยืนยัน",Dl.value=a||"",Il.value="confirm",xl.value=!0,new Promise(e=>{Sl=e})}({message:"ยืนยันย้าย Feedback นี้ไปยังรายการที่จัดการแล้ว?"})))return;Zl.value=e.FeedbackID;try{await K.put(`/feedbacks/${e.FeedbackID}/handle`),Na("ย้าย Feedback ไปยังรายการที่จัดการแล้ว"),M("refresh"),V.push({name:"report-feedbacks-handled"})}catch(a){const e=a.response?.data?.message||"การดำเนินการล้มเหลว";Ba(e),await Ll({message:e,type:"error"})}finally{Zl.value=null}}(yl.value))}const xl=l(!1),Dl=l(""),Tl=l(""),Il=l("info");let Sl=null;function Ll({title:e="",message:a="",type:l="info"}={}){return Tl.value=e||("confirm"===l?"ยืนยัน":"แจ้งเตือน"),Dl.value=a||"",Il.value=l,xl.value=!0,Promise.resolve()}function Vl(){xl.value=!1,setTimeout(()=>{Dl.value="",Tl.value="",Il.value="info",Sl=null},300)}function ql(){xl.value=!1,Sl&&(Sl(!0),Sl=null)}function Al(){xl.value=!1,Sl&&(Sl(!1),Sl=null)}function Rl(e){if(!e)return"bg-secondary";const a=new Date,l=new Date(e);if(isNaN(l.getTime()))return"bg-secondary";const t=a-l,s=Math.floor(t/1e3),n=Math.floor(s/60),i=Math.floor(n/60),r=Math.floor(i/24);return s<60?"bg-success":n<60?"bg-info":i<24?"bg-warning text-dark":r<7?"bg-orange":"bg-danger"}const Ul=s(()=>Za.value.reduce((e,a)=>{const l=(a?.FeedbackValue??"").toString().toLowerCase().trim();return"1"===l||"like"===l||"true"===l?e+1:e},0)),Ql=s(()=>Za.value.reduce((e,a)=>{const l=(a?.FeedbackValue??"").toString().toLowerCase().trim();return"0"===l||"unlike"===l||"false"===l?e+1:e},0)),_l=s(()=>Za.value.reduce((e,a)=>{const l=(a?.FeedbackValue??"").toString().toLowerCase().trim();return"2"===l||"pending"===l?e+1:e},0)),Ol=s(()=>({labels:["Unlike","Like","Pending"],datasets:[{data:[Ql.value,Ul.value,_l.value],backgroundColor:["#FF3B30","#34C759","#FF9500"],borderWidth:0}]})),Ml={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}}},Nl=s(()=>{const e=Za.value.map(e=>{const a=e?.Timestamp;if(!a)return"Unknown";const l=new Date(a);return isNaN(l.getTime())?String(a).split("T")[0]||String(a):l.toISOString().slice(0,10)}),a=Array.from(new Set(e)).sort();return a.length?a:["All"]}),Bl=s(()=>{const e=Nl.value,a=e.map(e=>Za.value.filter(a=>{const l=a?.Timestamp,t=l?isNaN(new Date(l).getTime())?String(l).split("T")[0]:new Date(l).toISOString().slice(0,10):"Unknown",s=(a?.FeedbackValue??"").toString().toLowerCase().trim();return t===e&&("1"===s||"like"===s||"true"===s)}).length),l=e.map(e=>Za.value.filter(a=>{const l=a?.Timestamp,t=l?isNaN(new Date(l).getTime())?String(l).split("T")[0]:new Date(l).toISOString().slice(0,10):"Unknown",s=(a?.FeedbackValue??"").toString().toLowerCase().trim();return t===e&&("0"===s||"unlike"===s||"false"===s)}).length),t=e.map(e=>Za.value.filter(a=>{const l=a?.Timestamp,t=l?isNaN(new Date(l).getTime())?String(l).split("T")[0]:new Date(l).toISOString().slice(0,10):"Unknown",s=(a?.FeedbackValue??"").toString().toLowerCase().trim();return t===e&&("2"===s||"pending"===s)}).length);return{labels:e,datasets:[{label:"Unlike",data:l,borderColor:"#FF3B30",backgroundColor:"rgba(255,59,48,0.15)",fill:!0,tension:.35},{label:"Like",data:a,borderColor:"#34C759",backgroundColor:"rgba(52,199,89,0.15)",fill:!0,tension:.35},{label:"Pending",data:t,borderColor:"#FF9500",backgroundColor:"rgba(255,149,0,0.15)",fill:!0,tension:.35}]}}),Pl={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom"}},scales:{y:{beginAtZero:!0,ticks:{precision:0}}}},El=l(null),jl=l(null);let Kl,Hl,Wl=!1;function zl(){Wl||(Wl=!0,Kl&&(Kl.destroy(),Kl=null),Hl&&(Hl.destroy(),Hl=null),I(()=>{El.value&&Ol.value&&(Kl=new j(El.value,{type:"doughnut",data:Ol.value,options:Ml})),jl.value&&Bl.value&&(Hl=new j(jl.value,{type:"line",data:Bl.value,options:Pl})),Wl=!1}))}n(()=>{zl(),function(){try{B=P(E.FEEDBACKS,{axios:K,onOpen:()=>{N.value=!0},onMessage:e=>{const a=(e?.type||"").toString().toLowerCase(),l=e?.data||{},t=(l?.action||e?.action||"").toString().toLowerCase();("feedback_update"===a||"update"===a||"updated"===t||"created"===t||"deleted"===t||null!==(l?.feedbackId??e?.feedbackId??null))&&M("refresh")},onError:e=>{N.value=!1},onClose:()=>{N.value=!1},autoReconnect:!0})}catch(e){N.value=!1}}()}),t([Ol,Bl],()=>{zl()},{deep:!0}),i(()=>{Kl&&(Kl.destroy(),Kl=null),Hl&&(Hl.destroy(),Hl=null),B&&(B.disconnect(),B=null,N.value=!1)});const $l=l(null),Zl=l(null),Gl=l(!1),Jl=l(!1),Xl=l(!1),Yl=l([]),et=s(()=>{const e=Yl.value||[],a=[],l=e.filter(e=>!String(e.CategoriesID).includes("-")).sort((e,a)=>String(e.CategoriesID).localeCompare(String(a.CategoriesID),void 0,{numeric:!0}));for(const t of l){a.push({...t,isMain:!0});const l=String(t.CategoriesID),s=e.filter(e=>{const a=String(e.CategoriesID);return a!==l&&a.startsWith(l+"-")}).sort((e,a)=>String(e.CategoriesID).localeCompare(String(a.CategoriesID),void 0,{numeric:!0}));for(const e of s)a.push({...e,isMain:!1})}return a}),at=l(""),lt=l({questionTitle:"",questionText:"",reviewDate:"",categoriesId:"",keywords:[]}),tt=l(null);function st(){lt.value={questionTitle:"",questionText:"",reviewDate:(new Date).toISOString().slice(0,10),categoriesId:"",keywords:[]},at.value=""}function nt(){Gl.value=!1,tt.value=null,st()}function it(){(at.value||"").split(/[;,\n]/).map(e=>e.trim()).filter(Boolean).forEach(e=>{lt.value.keywords.includes(e)||lt.value.keywords.push(e)}),at.value=""}async function rt(){if(tt.value)if(lt.value.questionTitle&&lt.value.questionText&&lt.value.categoriesId&&lt.value.reviewDate){Xl.value=!0;try{const e={questionTitle:lt.value.questionTitle,questionText:lt.value.questionText,reviewDate:lt.value.reviewDate,categoriesId:lt.value.categoriesId,keywords:lt.value.keywords};await K.put(`/questionsanswers/update/${tt.value.QuestionsAnswersID}`,e),await K.put(`/feedbacks/${tt.value.FeedbackID}/handle`),nt(),M("refresh")}catch(e){const a=e.response?.data?.message||e.message||"บันทึกไม่สำเร็จ";await Ll({message:a,type:"error"})}finally{Xl.value=!1}}else await Ll({message:"กรอกข้อมูลให้ครบก่อนบันทึก",type:"error"})}return(e,a)=>(o(),r("div",H,[u("div",W,[S.feedbacksLoading?(o(),r("div",z,[...a[8]||(a[8]=[u("div",{class:"spinner-border text-primary",role:"status"},[u("span",{class:"visually-hidden"},"Loading...")],-1),u("p",{class:"mt-2"},"Loading feedbacks data...",-1)])])):S.feedbacksError?(o(),r("div",$,"Error: "+v(S.feedbacksError),1)):(o(),r("div",Z,[_.value?(o(),r("div",G,[u("div",J,[a[9]||(a[9]=b(" กำลังแสดงผลสำหรับคำถาม ID: ",-1)),u("strong",null,v(_.value),1)])])):p("",!0),Ga.value>0?(o(),r("div",X,[u("div",Y,[u("div",ee,[u("canvas",{id:"feedbacks-pie-chart",ref_key:"pieCanvas",ref:El},null,512)])]),u("div",ae,[u("div",le,[u("canvas",{id:"feedbacks-bar-chart",ref_key:"barCanvas",ref:jl},null,512)])])])):p("",!0),u("div",te,[u("div",se,"Total: "+v(Ya.value),1),u("div",ne,[a[11]||(a[11]=u("i",{class:"bi bi-search search-icon"},null,-1)),m(u("input",{type:"text",class:"search-input",placeholder:"ค้นหา feedback หรือ chatlog...","onUpdate:modelValue":a[0]||(a[0]=e=>Ea.value=e)},null,512),[[g,Ea.value]]),Ea.value?(o(),r("button",{key:0,class:"search-clear",onClick:a[1]||(a[1]=e=>Ea.value="")},[...a[10]||(a[10]=[u("i",{class:"bi bi-x-circle-fill"},null,-1)])])):p("",!0)])]),c(R,{modelValue:Ka.value,"onUpdate:modelValue":a[2]||(a[2]=e=>Ka.value=e),"show-sort":!0,"sort-options":Ha,"default-sort-by":"date","default-sort-order":"desc",statuses:Wa,"status-label":"ประเภท","show-date-presets":!0,"show-date-range":!0,onChange:za},null,8,["modelValue"]),u("div",ie,[u("table",re,[a[20]||(a[20]=u("thead",null,[u("tr",null,[u("th",null,"FeedbackID"),u("th",null,"FeedbackValue"),u("th",null,"Timestamp"),u("th",null,"UserQuery"),u("th",null,"QuestionText"),u("th",null,"Reason"),u("th",null,"Comment")])],-1)),u("tbody",null,[(o(!0),r(k,null,f(sl.value,e=>(o(),r("tr",{key:e.FeedbackID,class:y(["clickable-row",{"unlike-row":0===e.FeedbackValue}]),onClick:a=>function(e){yl.value=e,fl.value=!0}(e)},[u("td",ue,v(e.FeedbackID),1),u("td",de,[1===e.FeedbackValue?(o(),r(k,{key:0},[a[12]||(a[12]=u("i",{class:"bi bi-hand-thumbs-up-fill text-success me-2","aria-hidden":"true"},null,-1)),a[13]||(a[13]=u("span",{class:"fw-semibold"},"Like",-1))],64)):0===e.FeedbackValue?(o(),r(k,{key:1},[a[14]||(a[14]=u("i",{class:"bi bi-hand-thumbs-down-fill text-danger me-2","aria-hidden":"true"},null,-1)),a[15]||(a[15]=u("span",{class:"fw-semibold"},"Unlike",-1))],64)):2===e.FeedbackValue?(o(),r(k,{key:2},[a[16]||(a[16]=u("i",{class:"bi bi-hourglass-split text-warning me-2","aria-hidden":"true"},null,-1)),a[17]||(a[17]=u("span",{class:"fw-semibold"},"Pending",-1))],64)):(o(),r("span",ce,v(e.FeedbackValue),1))]),u("td",ve,[u("span",{class:y(["badge",Rl(e.Timestamp)])},v(w(U)(e.Timestamp)),3)]),u("td",pe,[u("div",{class:"cell-ellipsis",title:e.UserQuery||""},v(e.UserQuery||"-"),9,be)]),u("td",me,[u("div",{class:"cell-ellipsis",title:e.QuestionText||""},v(e.QuestionText||"-"),9,ge)]),u("td",ke,[e.FeedbackReason?(o(),r("span",{key:0,class:y(["reason-badge",pl(e.FeedbackReason)])},v(vl(e.FeedbackReason)),3)):(o(),r("span",fe,"-"))]),u("td",ye,[e.FeedbackComment?(o(),r("div",we,[u("button",{class:"comment-preview-btn",onClick:h(a=>{return l=e,gl.value=l,void(ml.value=!0);var l},["stop"])},[a[18]||(a[18]=u("i",{class:"bi bi-chat-square-text me-1"},null,-1)),u("span",Ce,v(bl(e.FeedbackComment)),1)],8,he)])):(o(),r("span",Fe,"-"))])],10,oe))),128)),0===Za.value.length?(o(),r("tr",xe,[...a[19]||(a[19]=[u("td",{colspan:"7",class:"text-center text-muted py-3"},"No feedbacks data found",-1)])])):p("",!0)])])]),u("div",De,[u("div",Te,"Showing "+v(al.value)+" to "+v(ll.value)+" of "+v(Ya.value)+" entries",1),u("nav",Ie,[u("ul",Se,[u("li",{class:y(["page-item",{disabled:1===Ja.value}])},[u("a",{class:"page-link",href:"#",onClick:h(ul,["prevent"])},"«")],2),u("li",{class:y(["page-item",{disabled:1===Ja.value}])},[u("a",{class:"page-link",href:"#",onClick:h(rl,["prevent"])},"‹")],2),(o(!0),r(k,null,f(nl.value,e=>(o(),r("li",{key:e,class:y(["page-item",{active:Ja.value===e}])},[u("a",{class:"page-link",href:"#",onClick:h(a=>il(e),["prevent"])},v(e),9,Le)],2))),128)),u("li",{class:y(["page-item",{disabled:Ja.value===el.value||0===el.value}])},[u("a",{class:"page-link",href:"#",onClick:h(ol,["prevent"])},"›")],2),u("li",{class:y(["page-item",{disabled:Ja.value===el.value||0===el.value}])},[u("a",{class:"page-link",href:"#",onClick:h(dl,["prevent"])},"»")],2)])])])]))]),(o(),d(T,{to:"body"},[c(D,{name:"apple-zoom"},{default:C(()=>[Gl.value?(o(),r("div",{key:0,class:"apple-modal-overlay",onClick:h(nt,["self"])},[u("div",Ve,[u("div",{class:"apple-modal-header"},[a[22]||(a[22]=u("div",{class:"d-flex flex-column"},[u("h5",{class:"apple-modal-title"},"Edit Question"),u("span",{class:"apple-modal-subtitle"},"Update review details inline")],-1)),u("button",{class:"apple-close-btn",onClick:nt,"aria-label":"Close"},[...a[21]||(a[21]=[u("i",{class:"bi bi-x-lg"},null,-1)])])]),u("div",qe,[Jl.value?(o(),r("div",Ae,[...a[23]||(a[23]=[u("div",{class:"apple-spinner mx-auto mb-3"},null,-1),u("p",{class:"text-secondary"},"Loading details...",-1)])])):(o(),r("div",Re,[u("div",Ue,[a[24]||(a[24]=u("label",null,"Question Title",-1)),m(u("input",{type:"text",class:"apple-input","onUpdate:modelValue":a[3]||(a[3]=e=>lt.value.questionTitle=e)},null,512),[[g,lt.value.questionTitle]])]),u("div",Qe,[a[25]||(a[25]=u("label",null,"Question Text",-1)),m(u("textarea",{class:"apple-input apple-textarea",rows:"4","onUpdate:modelValue":a[4]||(a[4]=e=>lt.value.questionText=e)},null,512),[[g,lt.value.questionText]])]),u("div",_e,[u("div",Oe,[u("div",Me,[a[26]||(a[26]=u("label",null,"Review Date",-1)),m(u("input",{type:"date",class:"apple-input","onUpdate:modelValue":a[5]||(a[5]=e=>lt.value.reviewDate=e)},null,512),[[g,lt.value.reviewDate]])])]),u("div",Ne,[u("div",Be,[a[29]||(a[29]=u("label",null,"Category",-1)),u("div",Pe,[m(u("select",{class:"apple-input","onUpdate:modelValue":a[6]||(a[6]=e=>lt.value.categoriesId=e)},[a[27]||(a[27]=u("option",{value:""},"-- Select Category --",-1)),(o(!0),r(k,null,f(et.value,e=>(o(),r("option",{key:e.CategoriesID,value:e.CategoriesID,class:y(e.isMain?"fw-bold text-muted bg-light":""),disabled:e.isMain},v(e.isMain?"▸ ":"  └ ")+v(e.CategoriesName||e.CategoriesID),11,Ee))),128))],512),[[F,lt.value.categoriesId]]),a[28]||(a[28]=u("i",{class:"bi bi-chevron-down select-icon"},null,-1))])])])]),u("div",je,[a[32]||(a[32]=u("label",null,"Keywords (comma separated)",-1)),u("div",Ke,[m(u("input",{type:"text",class:"apple-input","onUpdate:modelValue":a[7]||(a[7]=e=>at.value=e),onKeyup:x(h(it,["prevent"]),["enter"]),placeholder:"Type and press Enter...",style:{"padding-right":"40px"}},null,40,He),[[g,at.value]]),u("button",{class:"apple-icon-btn-abs",onClick:it,title:"Add keyword"},[...a[30]||(a[30]=[u("i",{class:"bi bi-plus-lg"},null,-1)])])]),u("div",We,[(o(!0),r(k,null,f(lt.value.keywords,(e,l)=>(o(),r("span",{key:e+l,class:"keyword-tag removable",onClick:e=>function(e){lt.value.keywords.splice(e,1)}(l)},[b(v(e)+" ",1),a[31]||(a[31]=u("i",{class:"bi bi-x ms-1"},null,-1))],8,ze))),128))])]),u("div",$e,[u("button",{class:"btn-apple-secondary",onClick:nt,disabled:Xl.value},"Cancel",8,Ze),u("button",{class:"btn-apple-primary",onClick:rt,disabled:Xl.value},[Xl.value?(o(),r("span",Je)):p("",!0),a[33]||(a[33]=b(" Save & Mark Reviewed ",-1))],8,Ge)])]))])])])):p("",!0)]),_:1})])),c(D,{name:"modal-fade"},{default:C(()=>[ml.value?(o(),r("div",{key:0,class:"comment-modal-overlay",onClick:h(kl,["self"])},[u("div",Xe,[u("div",{class:"comment-modal-header"},[a[35]||(a[35]=u("h5",{class:"comment-modal-title"},[u("i",{class:"bi bi-chat-square-text me-2"}),b(" Feedback Comment ")],-1)),u("button",{class:"comment-modal-close",onClick:kl,"aria-label":"ปิด"},[...a[34]||(a[34]=[u("i",{class:"bi bi-x-lg"},null,-1)])])]),u("div",Ye,[u("div",ea,[u("div",aa,[a[36]||(a[36]=u("span",{class:"comment-meta-label"},"Feedback ID:",-1)),u("span",la,v(gl.value?.FeedbackID),1)]),gl.value?.FeedbackReason?(o(),r("div",ta,[a[37]||(a[37]=u("span",{class:"comment-meta-label"},"Reason:",-1)),u("span",{class:y(["reason-badge",pl(gl.value.FeedbackReason)])},v(vl(gl.value.FeedbackReason)),3)])):p("",!0)]),u("div",sa,[u("p",na,v(gl.value?.FeedbackComment),1)])])])])):p("",!0)]),_:1}),c(D,{name:"modal-fade"},{default:C(()=>[xl.value?(o(),r("div",{key:0,class:"alert-modal-overlay",onClick:h(Vl,["self"])},[u("div",ia,[u("div",ra,[u("h5",oa,v(Tl.value||("confirm"===Il.value?"ยืนยัน":"แจ้งเตือน")),1),u("button",{class:"alert-modal-close",onClick:Vl,"aria-label":"ปิด"},[...a[38]||(a[38]=[u("i",{class:"bi bi-x-lg"},null,-1)])])]),u("div",ua,[u("p",{class:"alert-modal-message",innerHTML:Dl.value},null,8,da)]),"confirm"===Il.value?(o(),r("div",ca,[u("button",{class:"btn btn-outline-secondary btn-modal-cancel",onClick:Al},"ยกเลิก"),u("button",{class:"btn btn-primary btn-modal-confirm",onClick:ql},"ตกลง")])):(o(),r("div",va,[u("button",{class:"btn btn-primary btn-modal-confirm w-100",onClick:Vl},"ตกลง")]))])])):p("",!0)]),_:1}),(o(),d(T,{to:"body"},[fl.value?(o(),r("div",{key:0,class:"drawer-overlay",onClick:wl})):p("",!0),u("div",{class:y(["apple-drawer",{"drawer-open":fl.value}])},[u("div",{class:"drawer-header"},[a[40]||(a[40]=u("h5",{class:"drawer-title"},"รายละเอียด Feedback",-1)),u("button",{class:"btn-close-drawer",onClick:wl},[...a[39]||(a[39]=[u("i",{class:"bi bi-x-lg"},null,-1)])])]),u("div",pa,[u("div",ba,[a[41]||(a[41]=u("div",{class:"drawer-label"},"Feedback ID",-1)),u("div",ma,v(yl.value?.FeedbackID||"-"),1)]),u("div",ga,[a[45]||(a[45]=u("div",{class:"drawer-label"},"สถานะ",-1)),u("div",ka,[1===yl.value?.FeedbackValue?(o(),r("span",fa,[...a[42]||(a[42]=[u("i",{class:"bi bi-hand-thumbs-up-fill text-success fs-5"},null,-1),u("span",{class:"fw-semibold text-success"},"Like",-1)])])):0===yl.value?.FeedbackValue?(o(),r("span",ya,[...a[43]||(a[43]=[u("i",{class:"bi bi-hand-thumbs-down-fill text-danger fs-5"},null,-1),u("span",{class:"fw-semibold text-danger"},"Unlike",-1)])])):2===yl.value?.FeedbackValue?(o(),r("span",wa,[...a[44]||(a[44]=[u("i",{class:"bi bi-hourglass-split text-warning fs-5"},null,-1),u("span",{class:"fw-semibold text-warning"},"Pending",-1)])])):(o(),r("span",ha,"-"))])]),u("div",Ca,[a[46]||(a[46]=u("div",{class:"drawer-label"},"เวลา",-1)),u("div",Fa,[u("span",{class:y(["badge",Rl(yl.value?.Timestamp)])},v(w(U)(yl.value?.Timestamp)),3),u("span",xa,"("+v(hl(yl.value?.Timestamp))+")",1)])]),u("div",Da,[a[47]||(a[47]=u("div",{class:"drawer-label"},"คำถามผู้ใช้ (User Query)",-1)),u("div",Ta,v(yl.value?.UserQuery||"-"),1)]),u("div",Ia,[a[48]||(a[48]=u("div",{class:"drawer-label"},"คำตอบ (Question Text)",-1)),u("div",Sa,v(yl.value?.QuestionText||"-"),1)]),yl.value?.FeedbackReason?(o(),r("div",La,[a[49]||(a[49]=u("div",{class:"drawer-label"},"เหตุผล",-1)),u("div",Va,[u("span",{class:y(["reason-badge",pl(yl.value.FeedbackReason)])},v(vl(yl.value.FeedbackReason)),3)])])):p("",!0),yl.value?.FeedbackComment?(o(),r("div",qa,[a[50]||(a[50]=u("div",{class:"drawer-label"},"ความคิดเห็น",-1)),u("div",Aa,v(yl.value.FeedbackComment),1)])):p("",!0)]),u("div",Ra,[u("div",Ua,[0===yl.value?.FeedbackValue&&yl.value?.QuestionsAnswersID?(o(),r("button",{key:0,class:"btn-apple-primary flex-fill",onClick:Cl,disabled:$l.value===yl.value?.FeedbackID||Xl.value},[...a[51]||(a[51]=[u("i",{class:"bi bi-pencil-square me-2"},null,-1),b(" แก้ไขคำถาม ",-1)])],8,Qa)):p("",!0),1!==yl.value?.FeedbackValue?(o(),r("button",{key:1,class:"btn-apple-secondary text-danger flex-fill",onClick:Fl,disabled:Zl.value===yl.value?.FeedbackID},[Zl.value===yl.value?.FeedbackID?(o(),r("span",Oa)):(o(),r("i",Ma)),a[52]||(a[52]=b(" ลบ ",-1))],8,_a)):p("",!0)])])],2)]))]))}},[["__scopeId","data-v-1b89d561"]]),Ba={class:"report-page-container"},Pa={class:"main-content flex-grow-1"},Ea={class:"apple-dashboard"},ja={class:"dashboard-hero fade-in-up"},Ka={class:"hero-content"},Ha=["aria-label"],Wa={class:"hero-status"},za={class:"reports-grid px-4 pb-5 fade-in-up",style:{"animation-delay":"0.1s"}},$a=q({__name:"FeedbacksReportView",setup(a){j.register(...K);const t=e(),{appContext:i}=S(),{$axios:d}=i.config.globalProperties,b=l({}),m=l("");let g=null;const k=()=>{const e=document.querySelector(".sidebar");!M.value?(g=B.value,B.value=!1,e&&e.classList.remove("collapsed"),document.body.classList.add("sidebar-open"),document.body.classList.add("sidebar-mobile-expanded"),M.value=!0):(B.value=!!g,e&&g&&e.classList.add("collapsed"),document.body.classList.remove("sidebar-open"),document.body.classList.remove("sidebar-mobile-expanded"),M.value=!1,g=null)},f=l([]),C=l(!0),F=l(null),x=l(!1);let D=null;const T=l({responsive:!0,maintainAspectRatio:!1,cutout:"70%",plugins:{legend:{position:"right",labels:{usePointStyle:!0,boxWidth:8,font:{family:"-apple-system, sans-serif"}}},tooltip:{cornerRadius:12,padding:12}}}),I=l({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,grid:{borderDash:[4,4],color:"#f0f0f0"},ticks:{font:{family:"-apple-system, sans-serif"}}},x:{grid:{display:!1},ticks:{font:{family:"-apple-system, sans-serif"}}}},borderRadius:6,barThickness:24}),q=async()=>{C.value=!0;try{const e=await d.get("/feedbacks?all=true");f.value=e.data?.data||e.data||[]}catch(e){if(401===e.response?.status)return void t.replace("/login");F.value=e.response?.data?.message||"Failed to load feedbacks."}finally{C.value=!1}},A=s(()=>{const e=Array.isArray(f.value)?f.value:[];return{labels:["Like","Unlike","Pending"],datasets:[{data:[e.filter(e=>1===e.FeedbackValue||!0===e.FeedbackValue).length,e.filter(e=>0===e.FeedbackValue||!1===e.FeedbackValue).length,e.filter(e=>2===e.FeedbackValue).length],backgroundColor:["#34C759","#FF3B30","#FF9500"],borderWidth:0}]}}),R=s(()=>{const e=Array.isArray(f.value)?f.value:[];return{labels:["Like","Unlike","Pending"],datasets:[{label:"Feedbacks",data:[e.filter(e=>1===e.FeedbackValue||!0===e.FeedbackValue).length,e.filter(e=>0===e.FeedbackValue||!1===e.FeedbackValue).length,e.filter(e=>2===e.FeedbackValue).length],backgroundColor:["#34C759","#FF3B30","#FF9500"],borderRadius:6}]}});let U=null;return n(()=>{U=_();const e=localStorage.getItem("userToken"),a=localStorage.getItem("userType"),l=localStorage.getItem("userInfo");if(e){if(a&&(m.value=a),l)try{b.value=JSON.parse(l)}catch(s){}q(),D=P(E.FEEDBACKS,{axios:d,onMessage:e=>{"feedback_update"!==e?.type&&"created"!==e?.action&&"updated"!==e?.action||q()},onOpen:()=>{x.value=!0},onClose:()=>{x.value=!1}})}else t.replace({name:"login"})}),L(()=>{D&&D.disconnect(),"function"==typeof U&&U()}),(e,a)=>(o(),r("div",Ba,[c(O,{userType:m.value,userInfoObject:b.value},null,8,["userType","userInfoObject"]),w(M)?(o(),r("div",{key:0,class:"mobile-sidebar-backdrop",onClick:k,"aria-hidden":"true"})):p("",!0),u("main",Pa,[u("div",Ea,[u("div",ja,[u("div",Ka,[u("button",{class:"mobile-sidebar-toggle mobile-inline-toggle",onClick:h(k,["stop"]),"aria-label":w(M)?"Close sidebar":"Open sidebar"},[c(N,{isOpen:w(M)},null,8,["isOpen"])],8,Ha),a[0]||(a[0]=V('<div class="hero-heading d-flex align-items-center gap-3" data-v-3ae598a7><div class="apple-icon-box blue-gradient" data-v-3ae598a7><svg class="chat-icon" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" data-v-3ae598a7><path class="chat-path" d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z" data-v-3ae598a7></path></svg></div><div data-v-3ae598a7><h1 class="hero-title" data-v-3ae598a7>Feedbacks Report</h1><p class="hero-subtitle" data-v-3ae598a7>รายงานความพึงพอใจและข้อเสนอแนะทั้งหมด</p></div></div>',1))]),u("div",Wa,[u("div",{class:y(["apple-status-badge",{online:x.value}])},[a[1]||(a[1]=u("span",{class:"status-dot"},null,-1)),u("span",null,v(x.value?"Live":"Offline"),1)],2)])]),u("div",za,[c(Na,{feedbacks:f.value,feedbacksLoading:C.value,feedbacksError:F.value,feedbacksPieChartData:A.value,feedbacksBarChartData:R.value,chartOptions:T.value,barChartOptions:I.value,showLiveBadge:!1,onRefresh:q},null,8,["feedbacks","feedbacksLoading","feedbacksError","feedbacksPieChartData","feedbacksBarChartData","chartOptions","barChartOptions"])])])])]))}},[["__scopeId","data-v-3ae598a7"]]);export{$a as default};
