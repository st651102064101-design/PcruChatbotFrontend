import{k as e,f as a,I as l,r as s,g as t,H as i,c as o,o as c,p as n,a as d,d as r,u,z as v,i as g,h as m,t as b}from"./vue-vendor-CaqZERVf.js";import{_ as p,e as f,b as h,i as y,S as k,a as w}from"./index-CjxO0-0y.js";import"./axios-vendor-Dos3PyFQ.js";const x={class:"dashboard-container"},C={class:"main-content"},G=["aria-label"],I={class:"container-fluid"},P={class:"manage-google-account"},L={key:0,class:"text-center py-5"},E={key:1,class:"google-account-content"},T={key:0,class:"linked-card"},z={class:"card"},A={class:"card-body p-4"},B={class:"google-info-row"},S=["src"],j={key:1,class:"google-avatar-placeholder"},M={class:"google-info-details"},_={class:"mb-1"},D={class:"text-muted mb-1"},N={class:"text-muted"},O={class:"d-flex justify-content-end"},H=["disabled"],q={key:0,class:"spinner-border spinner-border-sm me-2"},F={key:1,class:"bi bi-x-circle me-2"},W={key:1,class:"not-linked-card"},$={class:"card"},J={class:"card-body p-4"},R={class:"d-grid"},U=["disabled"],V={key:0,class:"spinner-border spinner-border-sm me-2"},K={key:1,class:"google-icon me-2",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 48 48",width:"24",height:"24"},Q=p({__name:"ManageGoogleAccountView",setup(p){const Q=e(),X=a(),{appContext:Y}=l(),{$axios:Z,$swal:ee}=Y.config.globalProperties,{confirmAction:ae,ConfirmModalComponent:le}=f(),se=s(""),te=s({}),ie=s(window.innerWidth<=768);let oe=null,ce=null,ne=null;const de=s(!0),re=s(!1),ue=s(!1),ve=s(!1),ge=s({});function me(){ie.value&&(y.value=!y.value,y.value?(null===ne&&(ne=w.value),w.value=!1,document.body.classList.add("sidebar-open","sidebar-mobile-expanded")):(document.body.classList.remove("sidebar-open","sidebar-mobile-expanded"),null!==ne&&(w.value=ne,ne=null)))}function be(){ue.value=!0;const e=localStorage.getItem("userToken");Z.get("/auth/google/url.php",{params:{state:e}}).then(e=>{if(!e.data||!e.data.url)throw new Error("ไม่สามารถสร้าง URL ได้");window.location.href=e.data.url}).catch(e=>{ee.fire({icon:"error",title:"เกิดข้อผิดพลาด",text:"ไม่สามารถเชื่อมต่อกับ Google ได้"}),ue.value=!1})}async function pe(){try{await ae({title:"ยืนยันการยกเลิก",message:"คุณต้องการยกเลิกการผูกบัญชี Google หรือไม่?",variant:"danger",confirmText:"ยกเลิกการผูก",loadingText:"กำลังยกเลิก...",onConfirm:async()=>{await async function(){ve.value=!0;try{const e=await Z.delete("/auth/google/unlink");if(!e.data.success)throw new Error(e.data.message);re.value=!1,ge.value={},ee.fire({toast:!0,icon:"success",title:"ยกเลิกการผูกบัญชีเรียบร้อยแล้ว",position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}catch(e){ee.fire({icon:"error",title:"เกิดข้อผิดพลาด",text:e.response?.data?.message||"ไม่สามารถยกเลิกการผูกบัญชีได้"})}finally{ve.value=!1}}()}})}catch(e){}}function fe(e){if(!e)return"-";return new Date(e).toLocaleDateString("th-TH",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}return t(async()=>{oe=h();const e=localStorage.getItem("userToken"),a=localStorage.getItem("userType"),l=localStorage.getItem("userInfo");if(e){if(a&&(se.value=a),l)try{te.value=JSON.parse(l)}catch(s){}ce=()=>{const e=window.innerWidth<=768;e!==ie.value&&(ie.value=e,!e&&y.value&&(y.value=!1,document.body.classList.remove("sidebar-open","sidebar-mobile-expanded"),w.value=ne??w.value,ne=null))},window.addEventListener("resize",ce),"success"===Q.query.linked&&(ee.fire({toast:!0,icon:"success",title:"ผูกบัญชี Google สำเร็จ!",position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),X.replace({query:{}})),await async function(){de.value=!0;try{const e=await Z.get("/auth/google/status");e.data.success&&(re.value=e.data.linked,e.data.linked&&(ge.value={googleEmail:e.data.googleEmail,googleName:e.data.googleName,googlePicture:e.data.googlePicture,linkedAt:e.data.linkedAt}))}catch(e){ee.fire({icon:"error",title:"เกิดข้อผิดพลาด",text:"ไม่สามารถดึงข้อมูลสถานะการผูกบัญชีได้"})}finally{de.value=!1}}()}else X.replace({name:"login"})}),i(()=>{"function"==typeof oe&&oe(),ce&&window.removeEventListener("resize",ce),y.value=!1,document.body.classList.remove("sidebar-open","sidebar-mobile-expanded")}),(e,a)=>(c(),o("div",x,[u(y)?(c(),o("div",{key:0,class:"mobile-sidebar-backdrop",onClick:me,"aria-hidden":"true"})):n("",!0),d(k,{userType:se.value,userInfoObject:te.value},null,8,["userType","userInfoObject"]),r("main",C,[ie.value?(c(),o("button",{key:0,class:"mobile-sidebar-toggle mobile-inline-toggle",onClick:v(me,["stop"]),"aria-label":u(y)?"Close sidebar":"Open sidebar"},[...a[0]||(a[0]=[r("i",{class:"bi bi-list"},null,-1)])],8,G)):n("",!0),r("div",I,[r("div",P,[a[11]||(a[11]=r("div",{class:"page-header mb-4"},[r("h4",{class:"mb-1"},[r("i",{class:"bi bi-google me-2"}),g(" จัดการบัญชี Google ")]),r("p",{class:"text-muted mb-0"},"ผูกหรือยกเลิกการผูกบัญชี Google กับบัญชีของคุณ")],-1)),de.value?(c(),o("div",L,[...a[1]||(a[1]=[r("div",{class:"spinner-border text-primary",role:"status"},[r("span",{class:"visually-hidden"},"กำลังโหลด...")],-1),r("p",{class:"text-muted mt-3"},"กำลังโหลดข้อมูล...",-1)])])):(c(),o("div",E,[re.value?(c(),o("div",T,[r("div",z,[r("div",A,[a[5]||(a[5]=r("div",{class:"d-flex align-items-center mb-4"},[r("div",{class:"status-badge status-linked me-2"},[r("i",{class:"bi bi-check-circle-fill"})]),r("span",{class:"fw-semibold text-success"},"บัญชี Google ผูกเรียบร้อยแล้ว")],-1)),r("div",B,[ge.value.googlePicture?(c(),o("img",{key:0,src:ge.value.googlePicture,alt:"Google Profile",class:"google-avatar"},null,8,S)):(c(),o("div",j,[...a[2]||(a[2]=[r("i",{class:"bi bi-person-fill"},null,-1)])])),r("div",M,[r("h5",_,b(ge.value.googleName),1),r("p",D,b(ge.value.googleEmail),1),r("small",N,[a[3]||(a[3]=r("i",{class:"bi bi-calendar3 me-1"},null,-1)),g(" ผูกเมื่อ "+b(fe(ge.value.linkedAt)),1)])])]),a[6]||(a[6]=r("hr",{class:"my-4"},null,-1)),r("div",O,[r("button",{class:"btn btn-outline-danger",onClick:pe,disabled:ve.value},[ve.value?(c(),o("span",q)):(c(),o("i",F)),a[4]||(a[4]=g(" ยกเลิกการผูกบัญชี ",-1))],8,H)])])])])):(c(),o("div",W,[r("div",$,[r("div",J,[a[9]||(a[9]=m('<div class="d-flex align-items-center mb-4" data-v-a0e7c891><div class="status-badge status-not-linked me-2" data-v-a0e7c891><i class="bi bi-exclamation-circle" data-v-a0e7c891></i></div><span class="fw-semibold text-muted" data-v-a0e7c891>ยังไม่ได้ผูกบัญชี Google</span></div><div class="not-linked-info mb-4" data-v-a0e7c891><p class="text-muted mb-3" data-v-a0e7c891> ผูกบัญชี Google เพื่อเข้าสู่ระบบได้ง่ายและรวดเร็วขึ้น โดยไม่ต้องจำ ID และ Password </p><ul class="benefits-list" data-v-a0e7c891><li data-v-a0e7c891><i class="bi bi-check2 text-success me-2" data-v-a0e7c891></i>เข้าสู่ระบบด้วยคลิกเดียว</li><li data-v-a0e7c891><i class="bi bi-check2 text-success me-2" data-v-a0e7c891></i>ปลอดภัยด้วยการยืนยันตัวตนจาก Google</li><li data-v-a0e7c891><i class="bi bi-check2 text-success me-2" data-v-a0e7c891></i>ไม่ต้องจำรหัสผ่าน</li></ul></div>',2)),r("div",R,[r("button",{class:"btn btn-google py-3",onClick:be,disabled:ue.value},[ue.value?(c(),o("span",V)):(c(),o("svg",K,[...a[7]||(a[7]=[r("path",{fill:"#EA4335",d:"M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"},null,-1),r("path",{fill:"#4285F4",d:"M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"},null,-1),r("path",{fill:"#FBBC05",d:"M10.53 28.59c-.48-1.45-.76-2.99-.76-4.59s.27-3.14.76-4.59l-7.98-6.19C.92 16.46 0 20.12 0 24c0 3.88.92 7.54 2.56 10.78l7.97-6.19z"},null,-1),r("path",{fill:"#34A853",d:"M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"},null,-1)])])),a[8]||(a[8]=g(" ผูกบัญชี Google ",-1))],8,U)])])])])),a[10]||(a[10]=m('<div class="info-box mt-4" data-v-a0e7c891><div class="card bg-light border-0" data-v-a0e7c891><div class="card-body" data-v-a0e7c891><h6 class="mb-3" data-v-a0e7c891><i class="bi bi-info-circle text-primary me-2" data-v-a0e7c891></i> หมายเหตุ </h6><ul class="mb-0 text-muted small" data-v-a0e7c891><li data-v-a0e7c891>บัญชี Google หนึ่งสามารถผูกกับบัญชีผู้ใช้ได้เพียงหนึ่งบัญชีเท่านั้น</li><li data-v-a0e7c891>หากบัญชี Google ถูกผูกกับบัญชีอื่นอยู่แล้ว จะไม่สามารถผูกซ้ำได้</li><li data-v-a0e7c891>คุณยังสามารถLog in withID และ Password ได้ตามปกติ</li><li data-v-a0e7c891>การยกเลิกการผูกบัญชีจะไม่ลบข้อมูลใดๆ ในระบบ</li></ul></div></div></div>',1))]))])])]),d(u(le))]))}},[["__scopeId","data-v-a0e7c891"]]);export{Q as default};
