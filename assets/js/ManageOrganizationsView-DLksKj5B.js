import{f as e,I as a,r as t,l,e as s,g as o,H as n,c as i,o as r,p as c,a as d,d as u,u as p,z as b,i as v,s as m,G as f,F as g,b as y,t as h,n as w,L as k}from"./vue-vendor-CaqZERVf.js";import{_ as C,e as x,b as O,T as L,i as I,S as D,a as z,M as S}from"./index-YNQFrYK5.js";import"./axios-vendor-Dos3PyFQ.js";const N={class:"dashboard-container"},T={class:"main-content"},j=["aria-label"],B={class:"container-fluid"},M={key:0,class:"text-center py-5"},U={key:1},R={class:"d-block d-md-flex align-items-center justify-content-between mb-3"},_={class:"search-container mt-3 mt-md-0"},$={class:"bg-white shadow-apple rounded-4 overflow-hidden"},E={class:"table-responsive"},V={class:"table table-hover mb-0"},A={class:"py-3 ps-3"},P={"data-label":"ชื่อ",class:"py-3"},q={"data-label":"คำอธิบาย",class:"py-3"},F={class:"py-3 text-center"},W={class:"py-3 text-center"},G={class:"row-actions"},H=["onClick"],J=["onClick"],K={key:0},Q={class:"d-flex justify-content-between align-items-center p-3"},X={class:"small text-muted"},Y={"aria-label":"Page navigation"},Z={class:"pagination pagination-apple mb-0 align-items-center"},ee=["onClick"],ae={class:"modal-dialog modal-dialog-centered"},te={class:"modal-content apple-modal rounded-4 p-3 shadow-lg"},le={class:"modal-header border-0"},se={class:"modal-body"},oe={class:"mb-3"},ne={class:"upload-text"},ie={key:0},re={key:1,class:"file-selected"},ce={class:"d-flex align-items-center justify-content-center gap-3 mt-4"},de=["disabled"],ue={key:0,class:"spinner-border spinner-border-sm ms-2"},pe=["disabled"],be=["disabled"],ve={key:0,class:"spinner-border spinner-border-sm ms-2"},me={class:"modal-footer border-0 justify-content-center gap-3"},fe=["disabled"],ge=["disabled"],ye={key:0,class:"spinner-border spinner-border-sm me-2"},he={key:1,class:"bi bi-cloud-upload me-2"},we={class:"modal-dialog modal-dialog-centered modal-fullscreen"},ke={class:"modal-content"},Ce={class:"modal-header border-0"},xe={class:"modal-body text-center"},Oe=["src"],Le={class:"modal-dialog modal-dialog-centered"},Ie={class:"modal-content apple-modal rounded-4 p-3 shadow-lg"},De={class:"modal-header border-0"},ze={class:"modal-title"},Se={class:"modal-body"},Ne={class:"mb-3"},Te={class:"mb-3"},je={class:"modal-footer border-0"},Be=["disabled"],Me={key:0,class:"spinner-border spinner-border-sm me-1"},Ue=C({__name:"ManageOrganizationsView",setup(C){const Ue=e(),{appContext:Re}=a(),_e=Re.config.globalProperties.$axios,$e=Re.config.globalProperties.$swal,{confirmAction:Ee,ConfirmModalComponent:Ve}=x(),Ae=t({}),Pe=t(""),qe=t(window.innerWidth<=768);let Fe=null;const We=()=>{const e=document.querySelector(".sidebar");!I.value?(Fe=z.value,z.value=!1,e&&e.classList.remove("collapsed"),document.body.classList.add("sidebar-open"),document.body.classList.add("sidebar-mobile-expanded"),I.value=!0):(z.value=!!Fe,e&&Fe&&e.classList.add("collapsed"),document.body.classList.remove("sidebar-open"),document.body.classList.remove("sidebar-mobile-expanded"),I.value=!1,Fe=null)};let Ge=null,He=null;const Je=t([]),Ke=t(!0),Qe=t(null),Xe=t(""),Ye=t(1),Ze=t(5),ea=t(null),aa=t(!1),ta=t(null);let la=null;const sa=t(!1),oa=t(!1),na=t(null);let ia=null;const ra=t(null);let ca=null;const da=t(!1),ua=t(null),pa=t(!1),ba=t({OrgName:"",OrgDescription:""});function va(){ea.value=null,k(()=>{!la&&ta.value&&(la=new S(ta.value,{backdrop:!0,keyboard:!0})),la?.show()})}function ma(){la&&la.hide()}function fa(e){const a=e.target.files?.[0];a&&(a.name.toLowerCase().endsWith(".csv")?(ea.value=a,e.target&&(e.target.value="")):$e?.fire({icon:"error",title:"Invalid file",text:"Please upload a CSV file.",position:"bottom-end",toast:!0,timer:3e3}))}function ga(e){const a=e.dataTransfer?.files?.[0];a&&(a.name.toLowerCase().endsWith(".csv")?ea.value=a:$e?.fire({icon:"error",title:"Invalid file",text:"Please upload a CSV file.",position:"bottom-end",toast:!0,timer:3e3}))}const ya=async()=>{if(ea.value&&_e){aa.value=!0;try{const e=new FormData;e.append("file",ea.value);const a=await _e.post("/organizations/upload",e,{headers:{"Content-Type":"multipart/form-data"}});$e?.fire({icon:"success",title:a.data?.message||"อัปโหลดสำเร็จ!",position:"bottom-end",toast:!0,timer:3e3,showConfirmButton:!1}),await xa(),ma()}catch(e){const a=e.response?.data?.message||e.message||"เกิดข้อผิดพลาด";$e?.fire({icon:"error",title:"อัปโหลดไม่สำเร็จ",text:a,position:"bottom-end",toast:!0,timer:4e3,showConfirmButton:!1})}finally{aa.value=!1}}};function ha(){ba.value={OrgName:"",OrgDescription:""},da.value=!1,ua.value=null}function wa(){ha(),k(()=>{!ca&&ra.value&&(ca=new S(ra.value,{backdrop:!0,keyboard:!0})),ca?.show()})}function ka(){ca&&ca.hide(),ha()}const Ca=async()=>{if(ba.value.OrgName?.trim()){pa.value=!0;try{const e={orgName:ba.value.OrgName.trim(),orgDescription:ba.value.OrgDescription?.trim()||null};da.value&&ua.value?(await _e.put(`/organizations/crud/update/${ua.value}`,e),$e?.fire({icon:"success",title:"แก้ไขหน่วยงานสำเร็จ",position:"bottom-end",toast:!0,timer:2e3,showConfirmButton:!1})):(await _e.post("/organizations/crud/create",e),$e?.fire({icon:"success",title:"เพิ่มหน่วยงานสำเร็จ",position:"bottom-end",toast:!0,timer:2e3,showConfirmButton:!1})),ka(),await xa()}catch(e){const a=e.response?.data?.message||e.message||"เกิดข้อผิดพลาด";$e?.fire({icon:"error",title:"Error",text:a,position:"bottom-end",toast:!0,timer:4e3,showConfirmButton:!1})}finally{pa.value=!1}}else $e?.fire({icon:"warning",title:"กรุณากรอกชื่อหน่วยงาน",position:"bottom-end",toast:!0,timer:3e3,showConfirmButton:!1})},xa=async()=>{Ke.value=!0,Qe.value=null;try{const e=await _e.get("/organizations");Je.value=e.data?.data||e.data||[]}catch(e){Qe.value=e.response?.data?.message||"Failed to load organization data."}finally{Ke.value=!1}},Oa=l(()=>{const e=(Xe.value||"").toString().trim().toLowerCase();return e?Je.value.filter(a=>{const t=null!=a.OrgID?a.OrgID.toString().toLowerCase():"",l=(a.OrgName||"").toLowerCase(),s=(a.OrgDescription||"").toLowerCase();return t.includes(e)||l.includes(e)||s.includes(e)}):Je.value}),La=l(()=>Math.max(1,Math.ceil(Oa.value.length/Ze.value))),Ia=l(()=>Oa.value.length),Da=l(()=>0===Ia.value?0:(Ye.value-1)*Ze.value+1),za=l(()=>0===Ia.value?0:Math.min(Ye.value*Ze.value,Ia.value)),Sa=l(()=>{const e=(Ye.value-1)*Ze.value;return Oa.value.slice(e,e+Ze.value)}),Na=l(()=>{const e=La.value,a=Ye.value;return e<=4?Array.from({length:e},(e,a)=>a+1):a<=2?[1,2,3,4]:a>=e-1?[e-3,e-2,e-1,e]:[a-1,a,a+1,a+2]});function Ta(e){e>=1&&e<=La.value&&(Ye.value=e)}function ja(){Ta(Math.max(1,Ye.value-1))}function Ba(){Ta(Math.min(La.value,Ye.value+1))}function Ma(){Ta(1)}function Ua(){Ta(La.value)}function Ra(){!ia&&na.value&&(ia=new S(na.value,{backdrop:!0,keyboard:!0})),ia?.show()}s(Xe,()=>{Ye.value=1});const _a=async()=>{if(!oa.value){oa.value=!0;try{const e=await _e.get("/organizations/crud/template",{responseType:"blob"}),a=e.headers["content-disposition"];let t="organizations_template.csv";if(a){const e=a.match(/filename="?(.+?)"?$/);e&&e[1]&&(t=e[1])}const l=new Blob([e.data],{type:"text/csv"}),s=window.URL.createObjectURL(l),o=document.createElement("a");o.href=s,o.setAttribute("download",t),document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(s)}catch(e){$e?.fire({icon:"error",title:"ดาวน์โหลดไม่สำเร็จ",text:"ไม่สามารถดาวน์โหลดไฟล์ตัวอย่างได้",position:"bottom-end",toast:!0,timer:3e3,showConfirmButton:!1})}finally{oa.value=!1}}},$a=async()=>{if(!sa.value){sa.value=!0;try{const e=await _e.get("/organizations/last-upload",{responseType:"blob"}),a=e.headers["content-disposition"];let t="last_uploaded_organizations.csv";if(a){const e=a.match(/filename="?(.+)"?/);e&&e[1]&&(t=e[1])}const l=new Blob([e.data],{type:"text/csv"}),s=window.URL.createObjectURL(l),o=document.createElement("a");o.href=s,o.setAttribute("download",t),document.body.appendChild(o),o.click(),document.body.removeChild(o),window.URL.revokeObjectURL(s)}catch(e){const a=404===e.response?.status?"ไม่พบไฟล์ที่อัปโหลดก่อนหน้า":"ไม่สามารถดาวน์โหลดไฟล์ได้";$e?.fire({icon:"error",title:"ดาวน์โหลดไม่สำเร็จ",text:a,position:"bottom-end",toast:!0,timer:3e3,showConfirmButton:!1})}finally{sa.value=!1}}};return o(()=>{He=O();[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(e=>new L(e));const e=localStorage.getItem("userToken"),a=localStorage.getItem("userType"),t=localStorage.getItem("userInfo");if(e){if(a&&(Pe.value=a),t)try{Ae.value=JSON.parse(t)}catch(l){}Ge=()=>{const e=window.innerWidth<=768;e!==qe.value&&(qe.value=e,!e&&I.value&&(I.value=!1,document.body.classList.remove("sidebar-open","sidebar-mobile-expanded"),z.value=Fe??z.value,Fe=null))},window.addEventListener("resize",Ge),xa()}else Ue.replace({name:"login"})}),n(()=>{if("function"==typeof He&&He(),Ge&&window.removeEventListener("resize",Ge),I.value=!1,document.body.classList.remove("sidebar-open","sidebar-mobile-expanded"),la){try{la.dispose()}catch(e){}la=null}if(ia){try{ia.dispose()}catch(e){}ia=null}if(ca){try{ca.dispose()}catch(e){}ca=null}}),(e,a)=>(r(),i("div",N,[p(I)?(r(),i("div",{key:0,class:"mobile-sidebar-backdrop",onClick:We,"aria-hidden":"true"})):c("",!0),d(D,{userType:Pe.value,userInfoObject:Ae.value},null,8,["userType","userInfoObject"]),u("main",T,[qe.value?(r(),i("button",{key:0,class:"mobile-sidebar-toggle mobile-inline-toggle",onClick:b(We,["stop"]),"aria-label":p(I)?"Close sidebar":"Open sidebar"},[...a[9]||(a[9]=[u("i",{class:"bi bi-list"},null,-1)])],8,j)):c("",!0),u("div",B,[Ke.value?(r(),i("div",M,[...a[10]||(a[10]=[u("div",{class:"spinner-border text-primary",role:"status"},[u("span",{class:"visually-hidden"},"Loading...")],-1),u("p",{class:"mt-2"},"Loading organization data...",-1)])])):(r(),i("div",U,[u("div",R,[u("div",{class:"d-flex align-items-center justify-content-center gap-3 header-buttons"},[a[13]||(a[13]=u("h2",{class:"page-title"},"Manage Organizations",-1)),u("button",{class:"btn-add-apple",onClick:wa},[...a[11]||(a[11]=[u("i",{class:"bi bi-plus-lg me-1"},null,-1),v(" เพิ่มหน่วยงาน ",-1)])]),u("button",{class:"btn-upload-apple",onClick:va},[...a[12]||(a[12]=[u("i",{class:"bi bi-cloud-arrow-up"},null,-1)])])]),u("div",_,[a[15]||(a[15]=u("i",{class:"bi bi-search search-icon"},null,-1)),m(u("input",{type:"text",class:"search-input",placeholder:"ค้นหาหน่วยงาน...","onUpdate:modelValue":a[0]||(a[0]=e=>Xe.value=e)},null,512),[[f,Xe.value]]),Xe.value?(r(),i("button",{key:0,class:"search-clear",onClick:a[1]||(a[1]=e=>Xe.value="")},[...a[14]||(a[14]=[u("i",{class:"bi bi-x-lg"},null,-1)])])):c("",!0)])]),u("div",$,[u("div",E,[u("table",V,[a[19]||(a[19]=u("thead",null,[u("tr",null,[u("th",{class:"fw-bold py-3 ps-3"},"ID"),u("th",{class:"fw-bold py-3"},"ชื่อหน่วยงาน"),u("th",{class:"fw-bold py-3"},"คำอธิบาย"),u("th",{class:"fw-bold py-3 text-center"},"จำนวนเจ้าหน้าที่"),u("th",{class:"fw-bold py-3 text-center"},"ACTIONS")])],-1)),u("tbody",null,[(r(!0),i(g,null,y(Sa.value,e=>(r(),i("tr",{key:e.OrgID,class:"align-middle table-row-hover"},[u("td",A,h(e.OrgID),1),u("td",P,h(e.OrgName),1),u("td",q,h(e.OrgDescription||"-"),1),u("td",F,h(e.StaffCount||0),1),u("td",W,[u("div",G,[u("button",{class:"action-btn action-btn-edit",onClick:a=>function(e){da.value=!0,ua.value=e.OrgID,ba.value={OrgName:e.OrgName||"",OrgDescription:e.OrgDescription||""},k(()=>{!ca&&ra.value&&(ca=new S(ra.value,{backdrop:!0,keyboard:!0})),ca?.show()})}(e),title:"แก้ไข"},[...a[16]||(a[16]=[u("i",{class:"bi bi-pencil-square"},null,-1)])],8,H),u("button",{class:"action-btn action-btn-delete",onClick:a=>(async e=>{try{await Ee({title:"ยืนยันการลบ",message:`คุณต้องการลบหน่วยงาน "<strong>${e.OrgName}</strong>" หรือไม่?`,variant:"danger",confirmText:"ลบ",loadingText:"กำลังลบ...",onConfirm:async()=>{await _e.delete(`/organizations/crud/delete/${e.OrgID}`),$e?.fire({icon:"success",title:"ลบหน่วยงานสำเร็จ",position:"bottom-end",toast:!0,timer:2e3,showConfirmButton:!1}),await xa()}})}catch(a){const e=a.response?.data?.message||a.message||"เกิดข้อผิดพลาด";$e?.fire({icon:"error",title:"ลบไม่สำเร็จ",text:e,position:"bottom-end",toast:!0,timer:4e3,showConfirmButton:!1})}})(e),title:"ลบ"},[...a[17]||(a[17]=[u("i",{class:"bi bi-trash"},null,-1)])],8,J)])])]))),128)),0===Sa.value.length?(r(),i("tr",K,[...a[18]||(a[18]=[u("td",{colspan:"5",class:"text-center text-muted py-3"},"ไม่พบข้อมูลหน่วยงาน",-1)])])):c("",!0)])])]),u("div",Q,[u("div",X," Showing "+h(Da.value)+" to "+h(za.value)+" of "+h(Ia.value)+" entries ",1),u("nav",Y,[u("ul",Z,[u("li",{class:w(["page-item",{disabled:1===Ye.value}])},[u("a",{class:"page-link",href:"#",onClick:b(Ma,["prevent"]),"aria-label":"First"},"«")],2),u("li",{class:w(["page-item",{disabled:1===Ye.value}])},[u("a",{class:"page-link",href:"#",onClick:b(ja,["prevent"]),"aria-label":"Previous"},"‹")],2),(r(!0),i(g,null,y(Na.value,e=>(r(),i("li",{key:e,class:w(["page-item",{active:Ye.value===e}])},[u("a",{class:"page-link page-num rounded-3",href:"#",onClick:b(a=>Ta(e),["prevent"])},h(e),9,ee)],2))),128)),u("li",{class:w(["page-item",{disabled:Ye.value===La.value||0===La.value}])},[u("a",{class:"page-link",href:"#",onClick:b(Ba,["prevent"]),"aria-label":"Next"},"›")],2),u("li",{class:w(["page-item",{disabled:Ye.value===La.value||0===La.value}])},[u("a",{class:"page-link",href:"#",onClick:b(Ua,["prevent"]),"aria-label":"Last"},"»")],2)])])])])]))])]),u("div",{class:"modal fade",ref_key:"bsModalRef",ref:ta,tabindex:"-1","aria-hidden":"true"},[u("div",ae,[u("div",te,[u("div",le,[a[20]||(a[20]=u("div",{class:"modal-title w-100 text-center"},[u("div",{class:"fs-5 fw-bold"},"อัพโหลดไฟล์"),u("div",{class:"text-muted fs-6"},"หน่วยงาน CSV")],-1)),u("button",{type:"button",class:"btn-close btn-close-custom","aria-label":"Close",onClick:a[2]||(a[2]=e=>ma())})]),u("div",se,[u("div",oe,[u("div",{class:w(["upload-drop-area-apple",{"has-file":ea.value}]),onDrop:b(ga,["prevent"]),onDragover:a[3]||(a[3]=b(()=>{},["prevent"])),onClick:a[4]||(a[4]=a=>e.$refs.fileInput&&e.$refs.fileInput.click())},[a[23]||(a[23]=u("div",{class:"upload-icon-wrapper"},[u("i",{class:"bi bi-cloud-arrow-up"})],-1)),u("div",ne,[ea.value?(r(),i("span",re,[a[22]||(a[22]=u("i",{class:"bi bi-file-earmark-check me-2"},null,-1)),v(h(ea.value.name),1)])):(r(),i("span",ie,[...a[21]||(a[21]=[v("ลากไฟล์มาวางที่นี่ หรือ ",-1),u("strong",null,"คลิกเลือกไฟล์",-1)])]))]),a[24]||(a[24]=u("div",{class:"upload-hint"},"รองรับไฟล์ .csv เท่านั้น",-1)),u("input",{ref:"fileInput",type:"file",accept:".csv",class:"d-none",onChange:fa},null,544)],34),u("div",ce,[u("button",{type:"button",class:"btn-apple-secondary",onClick:b(_a,["prevent"]),disabled:oa.value},[a[25]||(a[25]=u("i",{class:"bi bi-file-earmark-text"},null,-1)),a[26]||(a[26]=u("span",null,"Template",-1)),oa.value?(r(),i("span",ue)):c("",!0)],8,de),u("button",{type:"button",class:"btn-apple-secondary",onClick:b(Ra,["prevent"]),disabled:oa.value},[...a[27]||(a[27]=[u("i",{class:"bi bi-image"},null,-1),u("span",null,"ดูตัวอย่าง",-1)])],8,pe),u("button",{type:"button",class:"btn-apple-secondary",onClick:b($a,["prevent"]),disabled:sa.value},[a[28]||(a[28]=u("i",{class:"bi bi-download"},null,-1)),a[29]||(a[29]=u("span",null,"ดาวน์โหลด",-1)),sa.value?(r(),i("span",ve)):c("",!0)],8,be)])])]),u("div",me,[u("button",{type:"button",class:"btn btn-secondary rounded-3 px-4",onClick:a[5]||(a[5]=e=>ma()),disabled:aa.value}," ยกเลิก ",8,fe),u("button",{type:"button",class:"btn btn-primary rounded-3 px-4",onClick:ya,disabled:!ea.value||aa.value},[aa.value?(r(),i("span",ye)):c("",!0),aa.value?c("",!0):(r(),i("i",he)),a[30]||(a[30]=v(" อัพโหลด ",-1))],8,ge)])])])],512),u("div",{class:"modal fade",ref_key:"templateModalRef",ref:na,tabindex:"-1","aria-hidden":"true"},[u("div",we,[u("div",ke,[u("div",Ce,[a[31]||(a[31]=u("h5",{class:"modal-title w-100 text-center"},"Template Example",-1)),u("button",{type:"button",class:"btn-close",onClick:a[6]||(a[6]=e=>{ia?.hide()})})]),u("div",xe,[u("img",{src:e.ex4Url,alt:"Template Example",class:"img-fluid",width:"100%",height:"100%"},null,8,Oe)])])])],512),u("div",{class:"modal fade",ref_key:"crudModalRef",ref:ra,tabindex:"-1","aria-hidden":"true"},[u("div",Le,[u("div",Ie,[u("div",De,[u("h5",ze,h(da.value?"แก้ไขหน่วยงาน":"เพิ่มหน่วยงานใหม่"),1),u("button",{type:"button",class:"btn-close",onClick:ka,"aria-label":"Close"})]),u("div",Se,[u("form",{onSubmit:b(Ca,["prevent"])},[u("div",Ne,[a[32]||(a[32]=u("label",{class:"form-label fw-bold"},[v("ชื่อหน่วยงาน "),u("span",{class:"text-danger"},"*")],-1)),m(u("input",{type:"text",class:"form-control","onUpdate:modelValue":a[7]||(a[7]=e=>ba.value.OrgName=e),required:"",placeholder:"เช่น สำนักส่งเสริมวิชาการและงานทะเบียน"},null,512),[[f,ba.value.OrgName]])]),u("div",Te,[a[33]||(a[33]=u("label",{class:"form-label fw-bold"},"คำอธิบาย",-1)),m(u("textarea",{class:"form-control","onUpdate:modelValue":a[8]||(a[8]=e=>ba.value.OrgDescription=e),rows:"3",placeholder:"อธิบายหน้าที่ของหน่วยงาน..."},null,512),[[f,ba.value.OrgDescription]])])],32)]),u("div",je,[u("button",{type:"button",class:"btn btn-secondary rounded-3",onClick:ka},"ยกเลิก"),u("button",{type:"button",class:"btn btn-primary rounded-3",onClick:Ca,disabled:pa.value},[pa.value?(r(),i("span",Me)):c("",!0),v(" "+h(da.value?"บันทึกการแก้ไข":"เพิ่มหน่วยงาน"),1)],8,Be)])])])],512),d(p(Ve))]))}},[["__scopeId","data-v-8fa71a84"]]);export{Ue as default};
