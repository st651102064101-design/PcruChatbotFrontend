import{I as e,r as t,f as o,l as a,g as l,H as s,c as r,o as n,d as i,t as c,i as u,p as m,y as d,z as v}from"./vue-vendor-CaqZERVf.js";import{_ as p}from"./index-YNQFrYK5.js";import"./axios-vendor-Dos3PyFQ.js";const g={class:""},f={class:"bg-c p-3 rounded-4 px-5 d-inline-block text-decoration-underline"},b={class:"mt-3"},x={class:"mt-3"},k=["href"],h={class:"mb-3 col-12 col-lg-auto mx-auto mx-lg-0 d-flex justify-content-center justify-content-lg-start"},w={class:"d-flex align-items-center gap-3"},y=["disabled"],I={key:0,class:"spinner-border spinner-border-sm me-2","aria-hidden":"true"},S={role:"status"},j={key:0,class:"mt-4"},C=p({__name:"CheckemailView",setup(p){const{appContext:C}=e(),{$axios:E,$swal:$}=C.config.globalProperties,A=t(""),_=t(""),B=t(60);let F=null;const P=o(),T=t(!1),D=()=>{P.push("/login")},L=()=>{window.close()};async function z(){if(!(B.value>0||T.value)){T.value=!0;try{await E.post("/forgotpassword",{email:_.value}),$.fire({toast:!0,icon:"success",title:"A new reset link has been sent!",position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),localStorage.setItem("resendTimestamp",Date.now().toString()),B.value=60,M()}catch(e){$.fire({icon:"error",title:"Failed to resend",text:e.response?.data?.message||"Could not connect to the server.",position:"bottom-end",timerProgressBar:!0})}finally{T.value=!1}}}const G=a(()=>B.value>0?{"background-color":"#E3E3E3",color:"#A3A3A3"}:{"background-color":"#E3E3E3",color:"black"}),H=a(()=>{if(!_.value)return"#";const e=_.value.split("@")[1];return"gmail.com"===e?"https://mail.google.com":["outlook.com","hotmail.com","live.com"].includes(e)?"https://outlook.live.com":`https://${e}`}),M=()=>{F=setInterval(()=>{B.value>0?B.value--:(clearInterval(F),F=null)},1e3)};return l(()=>{const e=localStorage.getItem("resetFlowActive"),t=localStorage.getItem("resetEmail"),o=localStorage.getItem("resendTimestamp");if(e&&t){if(localStorage.removeItem("resetFlowActive"),_.value=t,A.value=(e=>{if(!e||-1===e.indexOf("@"))return e;const[t,o]=e.split("@");return t.length<=3?`${t.slice(0,1)}**@${o}`:`${t.slice(0,3)}***@${o}`})(t),o){const e=60-Math.floor((Date.now()-parseInt(o,10))/1e3);B.value=e>0?e:0}else B.value=0;M()}else P.replace("/forgotpassword")}),s(()=>{F&&clearInterval(F),localStorage.removeItem("resetEmail"),localStorage.removeItem("resendTimestamp")}),(e,t)=>(n(),r("form",{onSubmit:v(z,["prevent"])},[i("div",g,[t[2]||(t[2]=i("header",{class:"fs-1 fw-bold mb-4 text-center text-lg-start"}," Check your email ",-1)),t[3]||(t[3]=i("p",{class:"text-center text-lg-start"},"we've sent a password reset link to:",-1)),i("div",f,c(A.value),1),i("div",b,[t[1]||(t[1]=i("div",null," If you don't receive the email within a few minutes, please check your spam or junk folder. ",-1)),i("div",x,[t[0]||(t[0]=u(" Go to your email ",-1)),i("a",{href:H.value,target:"_blank",rel:"noopener noreferrer",class:"fw-bold text-dark",onClick:L},"Click here",8,k)])]),i("div",h,[i("div",w,[i("button",{type:"submit",class:"btn rounded-3 fw-bold px-4 py-3 mt-4 fs-5 text",style:d(G.value),disabled:B.value>0||T.value},[T.value?(n(),r("span",I)):m("",!0),i("span",S,c(T.value?"Sending...":(B.value,"Resend Link")),1)],12,y),B.value>0?(n(),r("span",j,c(B.value)+" Sec.",1)):m("",!0)])]),i("div",{class:"col-12 col-lg-auto mx-auto mx-lg-0 d-flex justify-content-center justify-content-lg-start"},[i("button",{onClick:D,class:"btn btn-link fw-bold text-decoration-none",style:{color:"black"}}," Back to Login ")])])],32))}},[["__scopeId","data-v-329be339"]]);export{C as default};
