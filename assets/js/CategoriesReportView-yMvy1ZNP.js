import{r as e,I as a,g as t,H as s,l as r,e as l,c as i,o,d as n,a as c,h as u,n as d,t as g,i as v,p,u as m,s as f,G as b,F as C,b as h,z as y,w as x,T as S,q as D,f as k}from"./vue-vendor-CaqZERVf.js";import{_ as I,A as w,b as A,i as F,S as N,c as P,a as L}from"./index-CjxO0-0y.js";import{D as E,B as O}from"./index-DlWMEZ1A.js";import{c as T,W as j}from"./dashboard-styles-CiicuUba.js";import{C as B,r as $}from"./chart-CicJT4lR.js";import"./axios-vendor-Dos3PyFQ.js";const _={class:"dashboard-container"},R={class:"container-fluid pt-2 px-4 pb-5"},M={class:"d-flex align-items-center justify-content-between mb-4 fade-in-up"},z={class:"d-flex align-items-center gap-2"},Q={key:0,class:"text-center py-5 fade-in"},W={key:1,class:"alert apple-alert-danger mx-auto",role:"alert"},V={key:2,class:"fade-in-up",style:{"animation-delay":"0.1s"}},q={class:"row mb-4 g-3"},G={class:"col-md-4"},U={class:"apple-stat-card"},Z={class:"stat-content"},H={class:"stat-value"},J={class:"col-md-4"},Y={class:"apple-stat-card"},K={class:"stat-content"},X={class:"stat-value"},ee={class:"col-md-4"},ae={class:"apple-stat-card"},te={class:"stat-content"},se={class:"stat-value"},re={key:0,class:"row mb-4 g-4"},le={class:"col-12 col-lg-6"},ie={class:"apple-card chart-card h-100"},oe={class:"chart-area"},ne={class:"col-12 col-lg-6"},ce={class:"apple-card chart-card h-100"},ue={class:"chart-area"},de={class:"apple-card table-wrapper"},ge={class:"card-header-actions p-3 d-flex justify-content-between align-items-center"},ve={class:"apple-counter-capsule"},pe={class:"count"},me={class:"search-container"},fe={class:"table-responsive"},be={class:"table apple-table mb-0"},Ce={class:"align-middle parent-row"},he={class:"ps-4","data-label":"Actions"},ye=["onClick"],xe={class:"cat-id-cell fw-semibold text-primary","data-label":"ID"},Se={class:"fw-medium text-dark","data-label":"Category"},De={"data-label":"Type"},ke={class:"contact-cell","data-label":"Contact"},Ie={key:0},we={key:1,class:"text-muted small"},Ae={"data-label":"File"},Fe=["onClick"],Ne={key:1,class:"text-muted small opacity-50"},Pe={class:"cat-id-cell ps-4 text-secondary","data-label":"ID"},Le={class:"ps-4 text-secondary","data-label":"Category"},Ee={class:"contact-cell","data-label":"Contact"},Oe={key:0},Te={key:1,class:"text-muted small"},je={"data-label":"File"},Be=["onClick"],$e={key:1,class:"text-muted small opacity-50"},_e={key:0},Re={class:"pagination-footer"},Me={class:"pagination-info"},ze={key:0,"aria-label":"Pagination"},Qe={class:"pagination pagination-sm mb-0"},We=["onClick"],Ve={class:"apple-modal-content large-modal"},qe={class:"apple-modal-header py-3 px-4"},Ge={class:"d-flex align-items-center gap-3"},Ue={class:"text-secondary text-truncate d-block",style:{"max-width":"300px"}},Ze={class:"d-flex gap-2"},He=["href"],Je={class:"apple-modal-body p-0 bg-light position-relative"},Ye={key:0,class:"h-100 w-100"},Ke=["src"],Xe={key:1,class:"d-flex flex-column align-items-center justify-content-center h-100 text-center p-5"},ea=["href"],aa=I({__name:"CategoriesReport",props:{categories:Array,categoriesLoading:Boolean,categoriesError:String,categoriesPieChartData:Object,categoriesBarChartData:Object,qaCountsByCategoryId:Object,qaCountsByCategoryName:Object,searchQueryCategories:String,filteredCategories:Array,paginatedCategories:Array,categoriesStartIndex:Number,categoriesEndIndex:Number,categoriesTotalEntries:Number,categoriesCurrentPage:Number,categoriesTotalPages:Number,chartOptions:Object,barChartOptions:Object,showCharts:{type:Boolean,default:!0}},emits:["update:searchQueryCategories","refresh"],setup(k,{emit:I}){B.register(...$);const A=k,F=I,N=e({}),P=e({sortBy:"id",sortOrder:"asc",status:""}),L=[{value:"id",label:"ID"},{value:"name",label:"ชื่อหมวดหมู่"}],aa=[{value:"main",label:"Main",icon:"bi bi-folder-fill",color:"status-blue"},{value:"sub",label:"Sub",icon:"bi bi-folder",color:"status-gray"}];let ta=()=>{};const sa=e((A.searchQueryCategories||"").toString()),ra=e(!1),la=e(""),ia=e(""),oa=e(!1),{appContext:na}=a(),ca=na.config.globalProperties.$axios;let ua=null;function da(e){return null!=e&&/^\d{4}$/.test(String(e).trim())}function ga(e){return null!=e&&/^\d{3}$/.test(String(e).trim())}function va(e){return e?String(e).split(/ \|\|\| |\n/).map(e=>e.trim()).filter(Boolean):[]}function pa(e){if(!e)return null;const a=String(e).trim(),t=a.match(/0(?:2|[3-9]\d)[-\s]?\d{3}[-\s]?\d{3,4}|0\d{2}[-\s]?\d{3}[-\s]?\d{4}/);if(t)return`phone:${t[0].replace(/\D/g,"")}`;const s=a.match(/https?:\/\/[^\s]+/i);if(s)return`url:${s[0].trim().toLowerCase().replace(/\/$/,"").split("?")[0]}`;return`text:${a.toLowerCase().replace(/\s+/g," ").trim()}`}function ma(e){const a=String(e??"").trim(),t=[...(fa.value||[]).filter(e=>String(e.CategoriesID||"").trim()===a),...Pa(e,e)],s=[];for(const u of t)if(u&&u.Contact){const e=va(u.Contact);for(const a of e){const e=String(a||"").trim();e&&s.push(e)}}const r=new Map,l=new Set,i=new Set;for(const u of s){const e=u.match(/(0(?:2|[3-9]\d)[-\s]?\d{3}[-\s]?\d{3,4}|0\d{2}[-\s]?\d{3}[-\s]?\d{4})/),a=u.match(/https?:\/\/[^\s]+/i);if(e){const t=e[0].replace(/\D/g,""),s=u.match(/(?:ต่อ|ext\.?|x)\s*[:\.]?\s*(\d{1,6})/i),l=s?s[1]:null,i=a?a[0].trim().toLowerCase().replace(/\/$/,"").split("?")[0]:null;r.has(t)||r.set(t,{exts:new Set,urls:new Set}),l&&r.get(t).exts.add(l),i&&r.get(t).urls.add(i)}else a?l.add(a[0].trim().toLowerCase().replace(/\/$/,"").split("?")[0]):i.add(u)}const o=[],n=e=>e?9===e.length?e.slice(0,3)+"-"+e.slice(3):10===e.length?e.slice(0,3)+"-"+e.slice(3,6)+"-"+e.slice(6):e:"",c=new Set;for(const[u,d]of r.entries()){const e=Array.from(d.exts.values()).sort((e,a)=>e-a);let a=`เบอร์โทรศัพท์ : ${n(u)}`;e.length&&(a+=` ต่อ ${e.join(" หรือ ")}`),o.push(a);for(const t of d.urls)c.add(t)}for(const u of l)c.add(u);c.size>0&&o.push(`ลิงค์ : ${Array.from(c).join(" หรือ ")}`);for(const u of i)o.push(u);return o}t(()=>{ua=T(j.CATEGORIES,{axios:ca,onMessage:e=>{"CATEGORY_UPDATE"===e.type&&(ca.get("/getcategories").catch(()=>{}),F("refresh"))},onOpen:()=>{oa.value=!0},onClose:()=>{oa.value=!1}});try{ca.get("/getcategories")}catch(e){}}),s(()=>{ua&&ua.disconnect()});const fa=r(()=>Array.isArray(A.categories)&&A.categories.length?A.categories:Array.isArray(A.filteredCategories)&&A.filteredCategories.length?A.filteredCategories:[]),ba=r(()=>fa.value.filter(e=>e.CategoriesPDF).length),Ca=e(1),ha=e(5);ta=()=>{Ca.value=1};const ya=r(()=>{const e=Array.isArray(A.filteredCategories)&&A.filteredCategories.length?A.filteredCategories:Array.isArray(A.categories)?A.categories:[];let a=[];a="sub"===P.value.status?e.filter(e=>{if(!e)return!1;return!da(String(e.CategoriesID??"").trim())&&!La(e)}):"main"===P.value.status?e.filter(e=>{if(!e)return!1;return!da(String(e.CategoriesID??"").trim())&&La(e)}):e.filter(e=>{if(!e)return!1;const a=String(e.CategoriesID??"").trim();if(da(a))return!1;const t=String(e.ParentCategoriesID??"").trim();return!(!t||t!==a)||(!t||!function(e){if(null==e||""===e)return!1;return(Array.isArray(A.filteredCategories)&&A.filteredCategories.length?A.filteredCategories:Array.isArray(A.categories)?A.categories:[]).some(a=>String(a?.CategoriesID??"").trim()===String(e).trim())}(t))});const t=P.value.sortBy,s=P.value.sortOrder;return a.sort((e,a)=>{let r,l;if("id"===t){const t=String(e.CategoriesID||""),i=String(a.CategoriesID||""),o=Number(t),n=Number(i);if(isNaN(o)||isNaN(n))return"asc"===s?t.localeCompare(i,void 0,{numeric:!0}):i.localeCompare(t,void 0,{numeric:!0});r=o,l=n}else{if("name"!==t)return r=String(e.CategoriesID||""),l=String(a.CategoriesID||""),"asc"===s?r.localeCompare(l,void 0,{numeric:!0}):l.localeCompare(r,void 0,{numeric:!0});r=(e.CategoriesName||"").toLowerCase(),l=(a.CategoriesName||"").toLowerCase()}return r<l?"asc"===s?-1:1:r>l?"asc"===s?1:-1:0}),a}),xa=r(()=>{if(!wa.value){const e=ya.value,a=Number(Ca.value||1),t=Number(ha.value||5),s=(a-1)*t;return e.slice(s,s+t)}const e=Aa.value;if(!e||0===e.size)return[];return(fa.value||[]).filter(a=>{if(!a)return!1;const t=String(a.CategoriesID??"").trim();return!da(t)&&e.has(t)})}),Sa=r(()=>{const e=Array.isArray(xa.value)?xa.value:[];if(!e.length)return{labels:[],datasets:[]};const a=e.filter(e=>La(e)),t=a.map(e=>e.CategoriesName||String(e.CategoriesID)),s=a.map(e=>Pa(e.CategoriesID,e.CategoriesID)||[]),r=new Set;s.forEach(e=>e.forEach(e=>{const a=String(e.CategoriesName||e.CategoriesID||"").trim();a&&r.add(a)}));const l=Array.from(r),i=["#007AFF","#34C759","#FF9500","#FF3B30","#5856D6","#AF52DE","#5AC8FA","#FF2D55"];return{labels:t,datasets:l.map((e,t)=>{const r=a.map((a,t)=>{const r=s[t].find(a=>String(a.CategoriesName||a.CategoriesID||"").trim()===e);if(!r)return 0;const l=String(r.CategoriesID??"").trim();let i=(A.qaCountsByCategoryId||{})[l];if(null==i){i=(A.qaCountsByCategoryName||{})[String(r.CategoriesName||"").trim()]}const o=Number(i);return isNaN(o)?1:o});return{label:e,data:r,backgroundColor:i[t%i.length],borderRadius:4}})}}),Da=r(()=>({...A.barChartOptions||{},responsive:!0,maintainAspectRatio:!1,scales:{x:{stacked:!0,grid:{display:!1},ticks:{font:{family:"-apple-system, sans-serif"}}},y:{stacked:!0,grid:{borderDash:[4,4],color:"#f0f0f0"},beginAtZero:!0}},plugins:{legend:{position:"top",labels:{usePointStyle:!0,boxWidth:8}}},datasets:{bar:{maxBarThickness:32}}}));function ka(e,a){if(!e||!a)return!1;const t=String(a||"").toLowerCase().trim().normalize("NFC"),s=String(e.CategoriesID??"").toLowerCase().trim().normalize("NFC"),r=String(e.CategoriesName??"").toLowerCase().trim().normalize("NFC");return s.includes(t)||r.includes(t)}function Ia(e){const a=[];if(!e)return a;const t=fa.value,s=String(e.ParentCategoriesID??"").trim();s&&s!==String(e.CategoriesID??"").trim()&&t.some(e=>String(e.CategoriesID??"").trim()===s)&&a.push(s);const r=String(e.CategoriesID??"").trim();if(da(r)){const e=t.find(e=>ga(String(e.CategoriesID??"").trim())&&r.startsWith(String(e.CategoriesID??"").trim()));e&&a.push(String(e.CategoriesID))}return La(e)&&a.push(String(e.CategoriesID)),[...new Set(a)]}const wa=r(()=>{const e=sa.value&&""!==sa.value.toString().trim()?sa.value:A.searchQueryCategories||"";return String(e).toLowerCase().trim().normalize("NFC")}),Aa=r(()=>{const e=wa.value;if(!e)return new Set;const a=fa.value.filter(a=>ka(a,e)),t=new Set;return a.forEach(e=>{Ia(e).forEach(e=>{e&&t.add(String(e))})}),t});l(()=>A.searchQueryCategories,e=>{const a=(e||"").toString();a!==sa.value&&(sa.value=a)}),l(sa,e=>{F("update:searchQueryCategories",e);const a=(e||"").toString().trim();a&&function(e){if(!e)return;const a=fa.value.filter(a=>ka(a,e)),t=new Set;a.forEach(e=>{Ia(e).forEach(e=>{e&&t.add(String(e))})});const s={};t.forEach(e=>{e&&(s[e]=!0)}),N.value=s}(a)},{immediate:!1});const Fa=r(()=>{const e={};return(Aa.value||new Set).forEach(a=>{a&&(e[String(a)]=!0)}),e}),Na=r(()=>Object.assign({},N.value||{},Fa.value||{}));function Pa(e,a){const t=String(e??"").trim(),s=fa.value.slice(),r=wa.value;return s.filter(e=>{if(null==e)return!1;const s=String(e.CategoriesID??"").trim();if(String(e.CategoriesID)===String(a))return!1;if(da(s)){return!!(ga(t)&&s.startsWith(t))&&(!r||ka(e,r))}return!(String(e.ParentCategoriesID??"").trim()!==t)&&(!r||ka(e,r))}).sort((e,a)=>{const t=String(e.CategoriesID||""),s=String(a.CategoriesID||"");return t.localeCompare(s,void 0,{numeric:!0,sensitivity:"base"})})}function La(e){if(!e)return!1;const a=String(e.CategoriesID??"").trim(),t=String(e.ParentCategoriesID??"").trim();return!(!t||t!==a)||(!t||(!t||t===a))}const Ea=r(()=>wa.value?xa.value.length:ya.value.length),Oa=r(()=>{const e=ya.value.length;return Math.max(1,Math.ceil(e/ha.value))}),Ta=r(()=>Math.min(Math.max(1,Ca.value),Oa.value)),ja=r(()=>0===Ea.value?0:(Ta.value-1)*ha.value+1),Ba=r(()=>Math.min(Ta.value*ha.value,Ea.value)),$a=r(()=>{const e=Oa.value||1,a=Ta.value||1;return e<=4?Array.from({length:e},(e,a)=>a+1):a<=2?[1,2,3,4]:a>=e-1?[e-3,e-2,e-1,e]:[a-1,a,a+1,a+2]});function _a(){Ta.value>1&&Ca.value--}function Ra(){Ta.value<Oa.value&&Ca.value++}function Ma(){Ca.value=1}function za(){Ca.value=Oa.value}function Qa(e){const a=String(e).toLowerCase();return a.endsWith(".pdf")?"bi bi-file-earmark-pdf-fill text-danger":a.endsWith(".doc")||a.endsWith(".docx")?"bi bi-file-earmark-word-fill text-primary":"bi bi-file-earmark-text text-secondary"}function Wa(e,a){var t;la.value=(t=e)?function(e){return e&&/^https?:\/\//i.test(e)}(t)?t:`/uploads/${t}`:"#",ia.value=a||"File",ra.value=!0}function Va(){ra.value=!1}return l(()=>P.value.status,()=>{Ca.value=1}),l(sa,()=>{Ca.value=1}),(e,a)=>(o(),i("div",_,[n("div",R,[n("div",M,[a[4]||(a[4]=u('<div class="d-flex align-items-center gap-3" data-v-fa555e49><div class="apple-icon-box" data-v-fa555e49><i class="bi bi-folder2-open text-white" data-v-fa555e49></i></div><div data-v-fa555e49><h3 class="page-title m-0" data-v-fa555e49>Categories Report</h3><span class="text-secondary small" data-v-fa555e49>ภาพรวมและโครงสร้างหมวดหมู่</span></div></div>',1)),n("div",z,[n("div",{class:d(["apple-status-badge",{online:oa.value}])},[a[3]||(a[3]=n("span",{class:"status-dot"},null,-1)),n("span",null,g(oa.value?"Live":"Offline"),1)],2)])]),k.categoriesLoading?(o(),i("div",Q,[...a[5]||(a[5]=[n("div",{class:"apple-spinner"},null,-1),n("p",{class:"mt-3 text-secondary"},"Loading categories...",-1)])])):k.categoriesError?(o(),i("div",W,[a[6]||(a[6]=n("i",{class:"bi bi-exclamation-circle-fill me-2"},null,-1)),v(" "+g(k.categoriesError),1)])):(o(),i("div",V,[n("div",q,[n("div",G,[n("div",U,[a[8]||(a[8]=n("div",{class:"stat-icon-wrapper blue-gradient"},[n("i",{class:"bi bi-collection-fill"})],-1)),n("div",Z,[n("div",H,g(k.categoriesTotalEntries),1),a[7]||(a[7]=n("div",{class:"stat-label"},"หมวดหมู่ทั้งหมด",-1))])])]),n("div",J,[n("div",Y,[a[10]||(a[10]=n("div",{class:"stat-icon-wrapper purple-gradient"},[n("i",{class:"bi bi-diagram-3-fill"})],-1)),n("div",K,[n("div",X,g(Ea.value),1),a[9]||(a[9]=n("div",{class:"stat-label"},"หมวดหมู่หลัก",-1))])])]),n("div",ee,[n("div",ae,[a[12]||(a[12]=n("div",{class:"stat-icon-wrapper orange-gradient"},[n("i",{class:"bi bi-file-earmark-text-fill"})],-1)),n("div",te,[n("div",se,g(ba.value),1),a[11]||(a[11]=n("div",{class:"stat-label"},"เอกสารที่แนบ",-1))])])])]),k.showCharts?(o(),i("div",re,[n("div",le,[n("div",ie,[a[13]||(a[13]=n("div",{class:"card-header-clean"},[n("h5",null,"Distribution")],-1)),n("div",oe,[c(m(E),{"chart-data":k.categoriesPieChartData,"chart-options":k.chartOptions,style:{height:"260px"}},null,8,["chart-data","chart-options"])])])]),n("div",ne,[n("div",ce,[a[14]||(a[14]=n("div",{class:"card-header-clean"},[n("h5",null,"Structure Analysis")],-1)),n("div",ue,[c(m(O),{"chart-data":Sa.value,"chart-options":Da.value,style:{height:"260px"}},null,8,["chart-data","chart-options"])])])])])):p("",!0),c(w,{modelValue:P.value,"onUpdate:modelValue":a[0]||(a[0]=e=>P.value=e),"sort-options":L,statuses:aa,"status-label":"ประเภท","show-date-range":!1,"show-date-presets":!1,"show-number-range":!1,onChange:m(ta)},null,8,["modelValue","onChange"]),n("div",de,[n("div",ge,[n("div",ve,[a[15]||(a[15]=n("span",{class:"label"},"Total",-1)),a[16]||(a[16]=n("span",{class:"separator"},"|",-1)),n("span",pe,g(k.categoriesTotalEntries),1)]),n("div",me,[a[18]||(a[18]=n("i",{class:"bi bi-search search-icon"},null,-1)),f(n("input",{type:"text",class:"search-input",placeholder:"ค้นหาหมวดหมู่...","onUpdate:modelValue":a[1]||(a[1]=e=>sa.value=e)},null,512),[[b,sa.value]]),sa.value?(o(),i("button",{key:0,class:"search-clear",onClick:a[2]||(a[2]=e=>sa.value="")},[...a[17]||(a[17]=[n("i",{class:"bi bi-x-circle-fill"},null,-1)])])):p("",!0)])]),n("div",fe,[n("table",be,[a[25]||(a[25]=n("thead",null,[n("tr",null,[n("th",{class:"ps-4",style:{width:"60px"}}),n("th",null,"ID"),n("th",null,"Category Name"),n("th",null,"Type"),n("th",null,"Contact"),n("th",null,"File")])],-1)),n("tbody",null,[(o(!0),i(C,null,h(xa.value,(e,t)=>{return o(),i(C,{key:e.CategoriesID},[n("tr",Ce,[n("td",he,[(s=e.CategoriesID,r=e.CategoriesID,Pa(s,r).length>0?(o(),i("button",{key:0,class:"expand-btn",onClick:a=>{return t=e.CategoriesID,void(N.value[t]=!N.value[t]);var t}},[n("i",{class:d(["bi",Na.value[e.CategoriesID]?"bi-chevron-up":"bi-chevron-right"])},null,2)],8,ye)):p("",!0))]),n("td",xe,g(e.CategoriesID),1),n("td",Se,g(e.CategoriesName),1),n("td",De,[n("span",{class:d(La(e)?"apple-badge-blue":"apple-badge-gray")},g(La(e)?"Main":"Sub"),3)]),n("td",ke,[(ma(e.CategoriesID)||[]).length?(o(),i("div",Ie,[(o(!0),i(C,null,h(ma(e.CategoriesID),(e,a)=>(o(),i("div",{key:a,class:"small text-secondary"},g(e),1))),128))])):(o(),i("span",we,"-"))]),n("td",Ae,[e.CategoriesPDF?(o(),i("button",{key:0,onClick:y(a=>Wa(e.CategoriesPDF,e.CategoriesName),["prevent"]),class:"file-link-btn"},[n("i",{class:d(Qa(e.CategoriesPDF))},null,2),a[19]||(a[19]=n("span",null,"View File",-1))],8,Fe)):(o(),i("span",Ne,"-"))])]),c(S,{name:"list-slide"},{default:x(()=>[(o(!0),i(C,null,h(Na.value[e.CategoriesID]?Pa(e.CategoriesID,e.CategoriesID):[],t=>(o(),i("tr",{key:t.CategoriesID,class:"sub-row"},[a[22]||(a[22]=n("td",null,null,-1)),n("td",Pe,[a[20]||(a[20]=n("span",{class:"tree-line"},"└",-1)),v(" "+g(t.CategoriesID),1)]),n("td",Le,g(t.CategoriesName),1),a[23]||(a[23]=n("td",{"data-label":"Type"},[n("span",{class:"apple-badge-gray-outline"},"Sub")],-1)),n("td",Ee,[t.Contact?(o(),i("div",Oe,[(o(!0),i(C,null,h(va(t.Contact).filter(a=>!function(e,a){const t=ma(e),s=pa(a);if(!s)return!1;for(const r of t)if(pa(r)===s)return!0;return!1}(e.CategoriesID,a)),(e,a)=>(o(),i("div",{key:a,class:"small text-secondary"},g(e),1))),128))])):(o(),i("span",Te,"-"))]),n("td",je,[t.CategoriesPDF?(o(),i("button",{key:0,onClick:y(e=>Wa(t.CategoriesPDF,t.CategoriesName),["prevent"]),class:"file-link-btn"},[n("i",{class:d(Qa(t.CategoriesPDF))},null,2),a[21]||(a[21]=n("span",null,"View File",-1))],8,Be)):(o(),i("span",$e,"-"))])]))),128))]),_:2},1024)],64);var s,r}),128)),0===(Array.isArray(xa.value)?xa.value.length:(xa.value||[]).length)?(o(),i("tr",_e,[...a[24]||(a[24]=[n("td",{colspan:"6",class:"text-center text-muted py-5"},[n("div",{class:"empty-state"},[n("i",{class:"bi bi-folder-x"}),n("p",null,"No categories found")])],-1)])])):p("",!0)])])]),n("div",Re,[n("div",Me," แสดง "+g(ja.value)+" - "+g(Ba.value)+" รายการ ",1),Oa.value>0?(o(),i("nav",ze,[n("ul",Qe,[n("li",{class:d(["page-item",{disabled:1===Ta.value}])},[n("a",{class:"page-link",href:"#",onClick:y(Ma,["prevent"])},"«")],2),n("li",{class:d(["page-item",{disabled:1===Ta.value}])},[n("a",{class:"page-link",href:"#",onClick:y(_a,["prevent"])},"‹")],2),(o(!0),i(C,null,h($a.value,e=>(o(),i("li",{key:`page-${e}`,class:d(["page-item",{active:Ta.value===e}])},[n("a",{class:"page-link page-num",href:"#",onClick:y(a=>{var t;(t=e)>=1&&t<=Oa.value&&(Ca.value=t)},["prevent"])},g(e),9,We)],2))),128)),n("li",{class:d(["page-item",{disabled:Ta.value===Oa.value}])},[n("a",{class:"page-link",href:"#",onClick:y(Ra,["prevent"])},"›")],2),n("li",{class:d(["page-item",{disabled:Ta.value===Oa.value}])},[n("a",{class:"page-link",href:"#",onClick:y(za,["prevent"])},"»")],2)])])):p("",!0)])])])),c(D,{name:"apple-zoom"},{default:x(()=>{return[ra.value?(o(),i("div",{key:0,class:"apple-modal-overlay",onClick:y(Va,["self"])},[n("div",Ve,[n("div",qe,[n("div",Ge,[a[27]||(a[27]=n("div",{class:"icon-circle bg-danger-subtle text-danger"},[n("i",{class:"bi bi-file-earmark-pdf-fill"})],-1)),n("div",null,[a[26]||(a[26]=n("h6",{class:"m-0 fw-semibold text-dark"},"File Preview",-1)),n("small",Ue,g(ia.value),1)])]),n("div",Ze,[n("a",{href:la.value,target:"_blank",rel:"noopener",class:"apple-icon-btn",title:"Open in new tab"},[...a[28]||(a[28]=[n("i",{class:"bi bi-box-arrow-up-right"},null,-1)])],8,He),n("button",{class:"apple-close-btn",onClick:Va},[...a[29]||(a[29]=[n("i",{class:"bi bi-x-lg"},null,-1)])])])]),n("div",Je,[(e=la.value,String(e).toLowerCase().trim().endsWith(".pdf")?(o(),i("div",Ye,[n("iframe",{src:la.value,frameborder:"0",class:"w-100 h-100"},null,8,Ke)])):(o(),i("div",Xe,[a[30]||(a[30]=n("div",{class:"mb-3 text-secondary opacity-50"},[n("i",{class:"bi bi-file-earmark-x",style:{"font-size":"3rem"}})],-1)),a[31]||(a[31]=n("h6",{class:"text-dark"},"Preview Unavailable",-1)),a[32]||(a[32]=n("p",{class:"text-secondary small mb-4"},"This file type cannot be previewed directly.",-1)),n("a",{href:la.value,target:"_blank",rel:"noopener",class:"btn-apple-primary"}," Download File ",8,ea)])))])])])):p("",!0)];var e}),_:1})])]))}},[["__scopeId","data-v-fa555e49"]]),ta={class:"report-page-container"},sa={class:"main-content flex-grow-1"},ra={class:"apple-dashboard"},la={class:"dashboard-hero"},ia={class:"hero-content"},oa=["aria-label"],na={class:"reports-grid"},ca=I({__name:"CategoriesReportView",setup(l){B.register(...$);const u=k(),{appContext:d}=a(),{$axios:g}=d.config.globalProperties,v=e({}),f=e(""),b=e([]),C=e(!0),h=e(null),x=e(""),S=e(1),D=e(5),I=["#007AFF","#5856D6","#FF9500","#34C759","#FF3B30","#AF52DE","#00C7BE","#FF2D55","#5AC8FA","#FFCC00","#FF6482","#30D158"],w=e({responsive:!0,maintainAspectRatio:!1,cutout:"65%",plugins:{legend:{position:"right",labels:{padding:20,usePointStyle:!0}},tooltip:{backgroundColor:"rgba(29, 29, 31, 0.9)",cornerRadius:12}}}),E=e({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{beginAtZero:!0,grid:{color:"rgba(0,0,0,0.06)"}},x:{grid:{display:!1}}},borderRadius:8}),O=r(()=>{if(!x.value)return b.value;const e=x.value.toLowerCase();return b.value.filter(a=>a.CategoriesName?.toLowerCase().includes(e)||String(a.CategoriesID).includes(e))}),T=r(()=>O.value.length),j=r(()=>Math.ceil(T.value/D.value)||1),_=r(()=>(S.value-1)*D.value),R=r(()=>Math.min(_.value+D.value,T.value)),M=r(()=>O.value.slice(_.value,R.value)),z=r(()=>{const e=[];for(let a=1;a<=j.value;a++)e.push(a);return e}),Q=()=>{S.value=1},W=()=>{S.value>1&&S.value--},V=e=>{S.value=e},q=()=>{S.value<j.value&&S.value++},G=()=>{S.value=j.value},U=r(()=>({labels:b.value.map(e=>e.CategoriesName),datasets:[{data:b.value.map(()=>1),backgroundColor:I.slice(0,b.value.length)}]})),Z=r(()=>({labels:b.value.map(e=>e.CategoriesName),datasets:[{label:"Categories",data:b.value.map(()=>1),backgroundColor:I.slice(0,b.value.length)}]}));let H=null,J=null;const Y=()=>{const e=document.querySelector(".sidebar");!F.value?(J=L.value,L.value=!1,e&&e.classList.remove("collapsed"),document.body.classList.add("sidebar-open"),document.body.classList.add("sidebar-mobile-expanded"),F.value=!0):(L.value=!!J,e&&J&&e.classList.add("collapsed"),document.body.classList.remove("sidebar-open"),document.body.classList.remove("sidebar-mobile-expanded"),F.value=!1,J=null)};return t(()=>{H=A();const e=localStorage.getItem("userToken"),a=localStorage.getItem("userType"),t=localStorage.getItem("userInfo");if(e){if(a&&(f.value=a),t)try{v.value=JSON.parse(t)}catch(s){}(async()=>{C.value=!0,h.value=null;try{let e=(await g.get("/getcategories")).data;e&&!Array.isArray(e)&&Array.isArray(e.categories)&&(e=e.categories),b.value=e}catch(e){h.value=e.response?.data?.message||"Failed to load categories."}finally{C.value=!1}})()}else u.replace({name:"login"})}),s(()=>{"function"==typeof H&&H(),F.value=!1,document.body.classList.remove("sidebar-open"),document.body.classList.remove("sidebar-mobile-expanded")}),(e,a)=>(o(),i("div",ta,[c(N,{userType:f.value,userInfoObject:v.value},null,8,["userType","userInfoObject"]),m(F)?(o(),i("div",{key:0,class:"mobile-sidebar-backdrop",onClick:Y,"aria-hidden":"true"})):p("",!0),n("main",sa,[n("div",ra,[n("div",la,[n("div",ia,[n("button",{class:"mobile-sidebar-toggle mobile-inline-toggle",onClick:y(Y,["stop"]),"aria-label":m(F)?"Close sidebar":"Open sidebar"},[c(P,{isOpen:m(F)},null,8,["isOpen"])],8,oa),a[0]||(a[0]=n("h1",{class:"hero-title"},"Categories Report",-1)),a[1]||(a[1]=n("p",{class:"hero-subtitle"},"รายงานหมวดหมู่คำถาม-คำตอบ",-1))])]),n("div",na,[c(aa,{categories:b.value,categoriesLoading:C.value,categoriesError:h.value,categoriesPieChartData:U.value,categoriesBarChartData:Z.value,searchQueryCategories:x.value,filteredCategories:O.value,paginatedCategories:M.value,categoriesStartIndex:_.value,categoriesEndIndex:R.value,categoriesTotalEntries:T.value,categoriesCurrentPage:S.value,categoriesTotalPages:j.value,categoriesPagesToShow:z.value,categoriesFirstPage:Q,categoriesPrevPage:W,categoriesGoToPage:V,categoriesNextPage:q,categoriesLastPage:G,chartOptions:w.value,barChartOptions:E.value},null,8,["categories","categoriesLoading","categoriesError","categoriesPieChartData","categoriesBarChartData","searchQueryCategories","filteredCategories","paginatedCategories","categoriesStartIndex","categoriesEndIndex","categoriesTotalEntries","categoriesCurrentPage","categoriesTotalPages","categoriesPagesToShow","chartOptions","barChartOptions"])])])])]))}},[["__scopeId","data-v-81962c3d"]]);export{ca as default};
