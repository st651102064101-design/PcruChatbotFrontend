import{I as e,f as a,k as s,r as t,g as o,C as l,c as r,o as i,d as n,a as c,t as u,w as d,i as p,p as m,z as v,s as b,G as g,U as f,n as y}from"./vue-vendor-CaqZERVf.js";import{_ as x}from"./index-CjxO0-0y.js";import"./axios-vendor-Dos3PyFQ.js";const k={class:"google-callback-wrapper"},h={class:"callback-container"},I={key:0,class:"text-center"},w={key:1,class:"text-center"},C={class:"text-muted mb-4"},S={key:2,class:"link-account-form"},P={class:"google-info-card mb-4"},U=["src"],_={class:"google-details"},G={class:"mb-1"},z={class:"text-muted mb-0"},B={class:"mb-3 position-relative pt-2"},D={class:"mb-3 position-relative pt-2"},R=["type"],T={class:"d-grid gap-2 mt-4"},j=["disabled"],q={key:0,class:"spinner-border spinner-border-sm me-2"},V={key:3,class:"text-center"},J=x({__name:"GoogleCallbackView",setup(x){const{appContext:J}=e(),{$axios:N,$swal:O}=J.config.globalProperties,$=a(),L=s(),A=t(!0),E=t(""),F=t(!1),H=t({}),K=t(""),M=t(""),Q=t(!1),W=t(!1);async function X(){if(K.value&&M.value){W.value=!0;try{const e=await N.post("/auth/google/link-with-credentials",{id:K.value,password:M.value,googleId:H.value.googleId,email:H.value.email,name:H.value.name,picture:H.value.picture});e.data.success?(localStorage.setItem("userToken",e.data.token),localStorage.setItem("userType",e.data.usertype),localStorage.setItem("userInfo",JSON.stringify(e.data.userInfo)),O.fire({toast:!0,icon:"success",title:"ผูกบัญชีและเข้าสู่ระบบสำเร็จ!",position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),$.push("/dashboard")):O.fire({icon:"error",title:"ไม่สามารถผูกบัญชีได้",text:e.data.message||"เกิดข้อผิดพลาด"})}catch(e){O.fire({icon:"error",title:"เกิดข้อผิดพลาด",text:e.response?.data?.message||"ไม่สามารถผูกบัญชีได้"})}finally{W.value=!1}}else O.fire({icon:"warning",title:"กรุณากรอกข้อมูลให้ครบ",text:"ต้องระบุ ID และ Password"})}return o(async()=>{const{token:e,usertype:a,userInfo:s,needLink:t,googleData:o,error:l}=L.query;if(l)return A.value=!1,void(E.value=decodeURIComponent(l));if("true"===t&&o)try{return H.value=JSON.parse(decodeURIComponent(o)),F.value=!0,void(A.value=!1)}catch(r){return E.value="ข้อมูล Google ไม่ถูกต้อง",void(A.value=!1)}if(e)try{localStorage.setItem("userToken",e),localStorage.setItem("userType",decodeURIComponent(a)),s&&localStorage.setItem("userInfo",decodeURIComponent(s)),O.fire({toast:!0,icon:"success",title:"เข้าสู่ระบบสำเร็จ!",position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),$.push("/dashboard")}catch(r){E.value="เกิดข้อผิดพลาดในการประมวลผลข้อมูล",A.value=!1}else E.value="ไม่พบข้อมูลการเข้าสู่ระบบ",A.value=!1}),(e,a)=>{const s=l("router-link");return i(),r("div",k,[n("div",h,[A.value?(i(),r("div",I,[...a[3]||(a[3]=[n("div",{class:"spinner-border text-primary mb-3",role:"status"},[n("span",{class:"visually-hidden"},"กำลังดำเนินการ...")],-1),n("p",{class:"text-muted"},"กำลังตรวจสอบการเข้าสู่ระบบ...",-1)])])):E.value?(i(),r("div",w,[a[5]||(a[5]=n("div",{class:"error-icon mb-3"},[n("i",{class:"bi bi-exclamation-circle text-danger",style:{"font-size":"48px"}})],-1)),a[6]||(a[6]=n("h4",{class:"text-danger mb-3"},"เกิดข้อผิดพลาด",-1)),n("p",C,u(E.value),1),c(s,{to:"/login",class:"btn btn-primary"},{default:d(()=>[...a[4]||(a[4]=[p("กลับไปหน้าล็อกอิน",-1)])]),_:1})])):F.value?(i(),r("div",S,[n("div",P,[H.value.picture?(i(),r("img",{key:0,src:H.value.picture,alt:"Google Profile",class:"google-avatar"},null,8,U)):m("",!0),n("div",_,[n("h5",G,u(H.value.name),1),n("p",z,u(H.value.email),1)])]),a[10]||(a[10]=n("div",{class:"alert alert-info mb-4"},[n("i",{class:"bi bi-info-circle me-2"}),p(" บัญชี Google นี้ยังไม่ได้ผูกกับบัญชีในระบบ กรุณาระบุ ID และ Password เพื่อผูกบัญชี ")],-1)),n("form",{onSubmit:v(X,["prevent"])},[n("div",B,[b(n("input",{type:"number",class:"form-control border-dark border-2 rounded-3 pt-3","onUpdate:modelValue":a[0]||(a[0]=e=>K.value=e),required:"",placeholder:""},null,512),[[g,K.value]]),a[7]||(a[7]=n("label",{class:"fw-bold position-absolute top-0 ms-2 bg-white rounded-3 px-2 mb-0"},"ID",-1))]),n("div",D,[b(n("input",{type:Q.value?"text":"password",class:"form-control border-dark border-2 rounded-3 pt-3 pe-5","onUpdate:modelValue":a[1]||(a[1]=e=>M.value=e),required:"",minlength:"8",placeholder:""},null,8,R),[[f,M.value]]),a[8]||(a[8]=n("label",{class:"fw-bold position-absolute top-0 ms-2 bg-white rounded-3 px-2 mb-0"},"Password",-1)),n("button",{type:"button",onClick:a[2]||(a[2]=e=>Q.value=!Q.value),class:"btn btn-sm btn-link text-muted position-absolute end-0 top-0 mt-3 pt-1 me-2"},[n("i",{class:y(["bi",Q.value?"bi-eye-slash":"bi-eye"]),style:{"font-size":"1.25rem"}},null,2)])]),n("div",T,[n("button",{type:"submit",class:"btn btn-primary py-3 rounded-3",disabled:W.value},[W.value?(i(),r("span",q)):m("",!0),p(" "+u(W.value?"กำลังผูกบัญชี...":"ผูกบัญชีและเข้าสู่ระบบ"),1)],8,j),c(s,{to:"/login",class:"btn btn-outline-secondary py-2 rounded-3"},{default:d(()=>[...a[9]||(a[9]=[p(" ยกเลิก ",-1)])]),_:1})])],32)])):(i(),r("div",V,[...a[11]||(a[11]=[n("div",{class:"success-icon mb-3"},[n("i",{class:"bi bi-check-circle text-success",style:{"font-size":"48px"}})],-1),n("h4",{class:"text-success mb-3"},"เข้าสู่ระบบสำเร็จ",-1),n("p",{class:"text-muted"},"กำลังเปลี่ยนหน้า...",-1)])]))])])}}},[["__scopeId","data-v-6b1fb73a"]]);export{J as default};
