import{f as e,r as a,g as s,H as i,c as l,o as n,p as o,a as t,d,u as r,z as c,h as u,s as v,G as g,D as b,i as m,t as p,w as y,F as f,b as w,n as k,q as h}from"./vue-vendor-CaqZERVf.js";import{_ as x,i as N,S as K,a as I,d as F}from"./index-YNQFrYK5.js";import{F as L}from"./FinalRankingCard-CGPwIb50.js";import"./axios-vendor-Dos3PyFQ.js";const S={class:"dashboard-container"},W={class:"main-content"},C=["aria-label"],_={class:"container-fluid"},j={class:"synonyms-apple-card synonyms-shadow-apple p-3 apple-pop"},R={class:"card synonyms-shadow-apple mt-4 apple-fade",style:{animationDelay:"0.1s"}},T={class:"card-body"},B={class:"input-group mb-3"},O=["disabled"],P={key:0,class:"bi bi-hourglass-split me-1"},q={key:1,class:"bi bi-search me-1"},D={key:0,class:"negation-results mt-3"},M={class:"token-analysis mb-3 p-3 bg-light rounded"},z={class:"d-flex flex-wrap gap-2"},A=["title"],E={key:0,class:"badge bg-danger ms-1"},G={key:0,class:"negation-info p-3 border rounded border-danger bg-danger bg-opacity-10"},H={class:"mb-0"},J={class:"text-danger"},U={class:"bg-white px-2 py-1 rounded"},V={key:1,class:"negation-info p-3 border rounded border-success bg-success bg-opacity-10"},$={key:2,class:"mt-3"},Q={class:"results-list"},X={class:"d-flex justify-content-between"},Y={class:"text-muted"},Z={key:0,class:"mt-1"},ee={class:"badge bg-danger"},ae=x({__name:"ManageRankingSimulator",setup(x){const ae=e(),se=a({}),ie=a(""),le=a({core:1,synonym_support:.95,domain_support:.9,application_support:.2}),ne=a(window.innerWidth<=768);let oe=null;const te=()=>{const e=document.querySelector(".sidebar");!N.value?(oe=I.value,I.value=!1,e&&e.classList.remove("collapsed"),document.body.classList.add("sidebar-open"),document.body.classList.add("sidebar-mobile-expanded"),N.value=!0):(I.value=!!oe,e&&oe&&e.classList.add("collapsed"),document.body.classList.remove("sidebar-open"),document.body.classList.remove("sidebar-mobile-expanded"),N.value=!1,oe=null)};let de=null;const re=a(""),ce=a(!1),ue=a(null);async function ve(){if(re.value.trim()){ce.value=!0,ue.value=null;try{const e=(await F.post("/chat/respond",{message:re.value.trim()})).data,a=re.value.toLowerCase().split(/\s+/).filter(Boolean),s={};if(e.negationInfo?.negativeWordsFound)for(const d of e.negationInfo.negativeWordsFound)s[d.word]=d.modifier,d.targetKeyword&&(s[d.targetKeyword]=d.modifier);const i=new Set,l={};if(e.negationInfo?.negatedKeywords)for(const d of e.negationInfo.negatedKeywords)i.add(d.keyword),l[d.keyword]=d.negativeWord;const n=e.blockedKeywordsDisplay||[];for(const d of n)i.add(d);const o=[];for(const d of a){const a=["ไม่เอา","ไม่ต้อง","ไม่อยาก","ไม่ต้องการ","ไม่สนใจ","ไม่"];let l=null,t=null;const r=a.sort((e,a)=>a.length-e.length);for(const e of r)if(d.includes(e)){const a=d.indexOf(e);if(a>=0){l=e,t=d.slice(a+e.length);break}}l&&t?(o.push({text:l,isNegative:!0,modifier:-1,isKeyword:!1,isNegated:!1}),t&&o.push({text:t,isNegative:!1,modifier:null,isKeyword:i.has(t)||n.includes(t),isNegated:i.has(t)||n.includes(t)})):o.push({text:d,isNegative:s.hasOwnProperty(d)||a.includes(d),modifier:s[d]||(a.includes(d)?-1:null),isKeyword:i.has(d)||n.includes(d)||e.alternatives?.some(e=>e.keywords?.some(e=>e.toLowerCase().includes(d)||d.includes(e.toLowerCase()))),isNegated:i.has(d)||n.includes(d)})}const t=e.negationInfo?.hasNegation||n.length>0||e.blockedKeywords&&e.blockedKeywords.length>0;ue.value={query:re.value,tokens:o,hasNegation:t,negatedKeywords:e.negationInfo?.negatedKeywords||n.map(e=>({keyword:e,negativeWord:"ไม่เอา",modifier:-1})),negativeWordsFound:e.negationInfo?.negativeWordsFound||[],alternatives:e.alternatives||[]}}catch(e){ue.value={query:re.value,tokens:re.value.split(/\s+/).map(e=>({text:e,isNegative:!1,isKeyword:!1,isNegated:!1})),hasNegation:!1,negatedKeywords:[],negativeWordsFound:[],alternatives:[],error:e.message}}finally{ce.value=!1}}}return s(()=>{const e=localStorage.getItem("userToken"),a=localStorage.getItem("userType"),s=localStorage.getItem("userInfo");if(e){if(a&&(ie.value=a),s)try{se.value=JSON.parse(s)}catch(i){}de=()=>{const e=window.innerWidth<=768;e!==ne.value&&(ne.value=e,!e&&N.value&&(N.value=!1,document.body.classList.remove("sidebar-open","sidebar-mobile-expanded"),I.value=oe??I.value,oe=null))},window.addEventListener("resize",de)}else ae.replace({name:"login"})}),i(()=>{de&&window.removeEventListener("resize",de),N.value=!1,document.body.classList.remove("sidebar-open","sidebar-mobile-expanded")}),(e,a)=>(n(),l("div",S,[r(N)?(n(),l("div",{key:0,class:"mobile-sidebar-backdrop",onClick:te,"aria-hidden":"true"})):o("",!0),t(K,{userType:ie.value,userInfoObject:se.value},null,8,["userType","userInfoObject"]),d("main",W,[ne.value?(n(),l("button",{key:0,class:"mobile-sidebar-toggle mobile-inline-toggle",onClick:c(te,["stop"]),"aria-label":r(N)?"Close sidebar":"Open sidebar"},[...a[1]||(a[1]=[d("i",{class:"bi bi-list"},null,-1)])],8,C)):o("",!0),d("div",_,[a[9]||(a[9]=d("div",{class:"card synonyms-info-card synonyms-shadow-apple mb-3 apple-fade"},[d("div",{class:"card-body"},[d("div",{class:"fw-bold mb-2"},"ใช้อย่างไร"),d("ul",{class:"mb-2"},[d("li",null,"พิมพ์ข้อความตัวอย่างเพื่ออ้างอิงบริบท (ไม่ส่งไปคำนวณอัตโนมัติ)"),d("li",null,"กรอกคะแนนต่อเคส (Core/Synonym/Domain/Application) ตามความเหมือนของคำพ้อง"),d("li",null,"ปรับน้ำหนักสูตรชั่วคราว แล้วกดคำนวณเพื่อดู Total และ Breakdown"),d("li",null,"ปุ่มบันทึกถูกปิดในโหมดนี้ (ไม่กระทบระบบจริง)")])])],-1)),d("div",j,[t(L,{"show-score-inputs":!0,"show-sample-text":!0,"show-save":!1,"initial-scores":le.value},null,8,["initial-scores"])]),d("div",R,[d("div",T,[a[8]||(a[8]=u('<div class="d-flex align-items-center mb-3" data-v-d4b68213><div class="negation-icon me-3" data-v-d4b68213><svg width="32" height="32" viewBox="0 0 24 24" fill="none" data-v-d4b68213><circle cx="12" cy="12" r="10" stroke="#FF3B30" stroke-width="2" data-v-d4b68213></circle><path d="M15 9l-6 6M9 9l6 6" stroke="#FF3B30" stroke-width="2" stroke-linecap="round" data-v-d4b68213></path></svg></div><div data-v-d4b68213><h5 class="mb-0 fw-bold" data-v-d4b68213>ทดสอบคำปฏิเสธ (Negative Keywords)</h5><small class="text-muted" data-v-d4b68213>ทดสอบว่าระบบจะตรวจจับคำปฏิเสธได้หรือไม่</small></div></div>',1)),d("div",B,[v(d("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>re.value=e),class:"form-control",placeholder:"ลองพิมพ์ เช่น: ไม่เอาหอใน, ยกเว้นหอพัก, อย่าแนะนำทุน",onKeyup:b(ve,["enter"])},null,544),[[g,re.value]]),d("button",{class:"btn btn-danger",onClick:ve,disabled:ce.value||!re.value.trim()},[ce.value?(n(),l("i",P)):(n(),l("i",q)),m(" "+p(ce.value?"กำลังทดสอบ...":"ทดสอบ"),1)],8,O)]),t(h,{name:"fade"},{default:y(()=>[ue.value?(n(),l("div",D,[d("div",M,[a[2]||(a[2]=d("div",{class:"fw-bold mb-2"},[d("i",{class:"bi bi-diagram-3 me-2"}),m("Token Analysis")],-1)),d("div",z,[(n(!0),l(f,null,w(ue.value.tokens,(e,a)=>(n(),l("span",{key:a,class:k(["token-badge",{"token-negative":e.isNegative,"token-negated":e.isNegated,"token-keyword":e.isKeyword}]),title:e.isNegative?`Modifier: ${e.modifier}`:e.isNegated?"This keyword was negated":""},[m(p(e.text)+" ",1),e.isNegative?(n(),l("span",E,p(e.modifier),1)):o("",!0)],10,A))),128))])]),ue.value.hasNegation?(n(),l("div",G,[a[5]||(a[5]=d("div",{class:"fw-bold text-danger mb-2"},[d("i",{class:"bi bi-exclamation-triangle me-2"}),m(" พบคำปฏิเสธ! ")],-1)),d("ul",H,[(n(!0),l(f,null,w(ue.value.negatedKeywords,(e,s)=>(n(),l("li",{key:s},[d("strong",J,'"'+p(e.negativeWord)+'"',1),a[3]||(a[3]=m(" ทำให้ ",-1)),d("strong",null,'"'+p(e.keyword)+'"',1),a[4]||(a[4]=m(" มีตัวคูณ ",-1)),d("code",U,p(e.modifier),1)]))),128))])])):(n(),l("div",V,[...a[6]||(a[6]=[d("div",{class:"fw-bold text-success"},[d("i",{class:"bi bi-check-circle me-2"}),m(" ไม่พบคำปฏิเสธในประโยคนี้ ")],-1)])])),ue.value.alternatives&&ue.value.alternatives.length>0?(n(),l("div",$,[a[7]||(a[7]=d("div",{class:"fw-bold mb-2"},[d("i",{class:"bi bi-list-ol me-2"}),m("ผลลัพธ์ที่ได้")],-1)),d("div",Q,[(n(!0),l(f,null,w(ue.value.alternatives.slice(0,3),(e,a)=>(n(),l("div",{key:e.id,class:k(["result-item p-2 mb-2 border rounded",{"border-danger":e.finalRanking?.negationPenalty}])},[d("div",X,[d("strong",null,p(a+1)+". "+p(e.title),1),d("span",{class:k(["badge",e.finalRanking?.score>0?"bg-success":"bg-danger"])}," Score: "+p((e.finalRanking?.score||0).toFixed(3)),3)]),d("small",Y,p(e.preview?.slice(0,100))+"...",1),e.finalRanking?.negationPenalty?(n(),l("div",Z,[d("span",ee,"Negation Penalty: "+p(e.finalRanking.negationPenalty),1)])):o("",!0)],2))),128))])])):o("",!0)])):o("",!0)]),_:1})])])])])]))}},[["__scopeId","data-v-d4b68213"]]);export{ae as default};
