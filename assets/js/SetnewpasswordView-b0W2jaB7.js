import{I as e,f as s,r as a,j as t,l as r,g as o,c as i,o as l,d as n,s as d,U as c,v as p,n as u,i as m,p as b,t as w,z as h}from"./vue-vendor-CaqZERVf.js";import{_ as v}from"./index-CjxO0-0y.js";import"./axios-vendor-Dos3PyFQ.js";const f={class:""},g={class:"mb-3 position-relative pt-2 col-lg-10"},x=["type"],k={key:0},y={key:1},P={class:"mb-4 col-lg-10"},C={class:"list-unstyled small"},U={class:"d-grid gap-2 mb-5 col-12 col-lg-8 mx-auto mx-lg-0"},B=["disabled"],A={key:0,class:"spinner-border spinner-border-sm me-2","aria-hidden":"true"},I={role:"status"},L=v({__name:"SetnewpasswordView",setup(v){const{appContext:L}=e(),{$axios:N,$swal:_}=L.config.globalProperties,E=s(),S=a(""),j=a(null),T=a(null),F=a(!1),Z=a("password"),R=t({has8Chars:!1,hasUppercase:!1,hasNumber:!1}),V=r(()=>R.has8Chars&&R.hasUppercase&&R.hasNumber),Y=()=>{R.has8Chars=S.value.length>=8,R.hasUppercase=/[A-Z]/.test(S.value),R.hasNumber=/[0-9]/.test(S.value)},$=()=>{Z.value="password"===Z.value?"text":"password"},q=async()=>{if(!V.value)return void T.value.classList.add("is-invalid");T.value.classList.remove("is-invalid"),F.value=!0;const e=new URLSearchParams(window.location.search),s=e.get("token"),a=e.get("email");if(!s)return _.fire({toast:!0,icon:"error",title:"Invalid Link",text:"The password reset link is invalid or has expired.",position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),F.value=!1,void E.replace("/forgotpassword");try{const e={token:s,email:a,newPassword:S.value},t=await N.post("/setnewpassword",e);t.data&&!0===t.data.success?(_.fire({toast:!0,icon:"success",title:"Password Updated!",text:"You can now log in with your new password.",position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),E.push({name:"passwordupdated"})):_.fire({toast:!0,icon:"error",title:"Update Failed",text:t.data?.message||"An unexpected error occurred. Please try again.",position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}catch(t){_.fire({toast:!0,icon:"error",title:"Update Failed",text:t.response?.data?.message||"Could not connect to the server. Please try again.",position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0})}finally{F.value=!1}};return o(async()=>{const e=new URLSearchParams(window.location.search),s=e.get("token"),a=e.get("email");if(!s||!a)return _.fire({toast:!0,icon:"error",title:"Invalid Link",text:"The password reset link is incomplete or invalid.",position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),void E.replace("/forgotpassword");try{const e=await N.post("/validateresettoken",{token:s,email:a});if(!0!==e.data.success)throw new Error(e.data.message||"Token validation failed.")}catch(t){_.fire({toast:!0,icon:"error",title:"Invalid or Expired Link",text:t.response?.data?.message||"This password reset link is no longer valid.",position:"bottom-end",showConfirmButton:!1,timer:3e3,timerProgressBar:!0}),E.replace("/forgotpassword")}}),(e,s)=>(l(),i("form",{ref_key:"passwordForm",ref:j,onSubmit:h(q,["prevent"]),class:"needs-validation",novalidate:""},[n("div",f,[s[8]||(s[8]=n("header",{class:"fs-1 fw-bold mb-3 text-center text-lg-start"}," Set New Password ",-1)),s[9]||(s[9]=n("p",{class:"text-center text-lg-start mb-4"}," Please create a new password for your account. ",-1)),n("div",g,[d(n("input",{ref_key:"passwordInput",ref:T,type:Z.value,name:"password",class:"form-control border-dark border-2 rounded-3 pt-3 pe-5",id:"floatingPassword",placeholder:"","onUpdate:modelValue":s[0]||(s[0]=e=>S.value=e),required:"",pattern:"(?=.*\\d)(?=.*[A-Z]).{8,}",onInput:Y},null,40,x),[[c,S.value]]),s[3]||(s[3]=n("label",{class:"fw-bold position-absolute top-0 ms-2 bg-light rounded-3 px-2 mb-0",for:"floatingPassword"},"New Password",-1)),d(n("button",{type:"button",onClick:$,class:"btn btn-sm btn-link text-muted position-absolute end-0 top-0 mt-3 pt-1 me-2"},["password"===Z.value?(l(),i("span",k,[...s[1]||(s[1]=[n("i",{class:"bi bi-eye fs-5"},null,-1)])])):(l(),i("span",y,[...s[2]||(s[2]=[n("i",{class:"bi bi-eye-slash fs-5"},null,-1)])]))],512),[[p,S.value.length>0]])]),n("div",P,[s[7]||(s[7]=n("p",{class:"mb-1 text-center text-lg-start"},"Your password must have:",-1)),n("ul",C,[n("li",{class:u({"text-success":R.has8Chars})},[n("i",{class:u(["bi me-1",R.has8Chars?"bi-check-circle-fill":"bi-circle"])},null,2),s[4]||(s[4]=m(" At least 8 characters ",-1))],2),n("li",{class:u({"text-success":R.hasUppercase})},[n("i",{class:u(["bi me-1",R.hasUppercase?"bi-check-circle-fill":"bi-circle"])},null,2),s[5]||(s[5]=m(" At least one uppercase letter (A-Z) ",-1))],2),n("li",{class:u({"text-success":R.hasNumber})},[n("i",{class:u(["bi me-1",R.hasNumber?"bi-check-circle-fill":"bi-circle"])},null,2),s[6]||(s[6]=m(" At least one number (0-9) ",-1))],2)])]),n("div",U,[n("button",{type:"submit",class:"btn rounded-3 fw-bold py-3 px-5 mt-2 fs-5 text-nowrap",style:{"background-color":"#E3E3E3"},disabled:F.value||!V.value},[F.value?(l(),i("span",A)):b("",!0),n("span",I,w(F.value?"Updating...":"Update Password"),1)],8,B)])])],544))}},[["__scopeId","data-v-28c9a79b"]]);export{L as default};
