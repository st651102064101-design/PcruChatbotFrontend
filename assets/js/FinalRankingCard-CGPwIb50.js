import{r as a,l as e,e as o,g as t,c as l,o as s,d as n,h as r,a as i,w as c,p as u,t as p,q as d,s as v,G as h,n as m,F as y,b as g,i as k,y as w}from"./vue-vendor-CaqZERVf.js";import{a as b}from"./axios-vendor-Dos3PyFQ.js";import{d as _,_ as x,u as f}from"./index-YNQFrYK5.js";const F={class:"ranking-card-wrapper"},C={class:"ranking-header"},M={class:"score-pills"},N={key:0,class:"score-pill total-pill"},B={class:"pill-value"},S={key:0,class:"score-pill text-pill"},L={class:"pill-value"},A={class:"ranking-body"},j={key:0,class:"input-section sample-section"},D={class:"textarea-wrapper"},V={key:0,class:"column scores-column"},W={class:"inputs-grid"},T={class:"input-label"},z={class:"input-wrapper"},U=["onUpdate:modelValue","onFocus"],H={class:"column weights-column"},I={class:"inputs-grid"},R={class:"input-label"},Q={class:"input-wrapper"},O=["onUpdate:modelValue","onFocus"],$={class:"actions-row"},q=["disabled"],E={key:0,class:"btn-icon",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none"},G={key:1,class:"btn-icon spinning",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none"},P=["disabled"],Z={key:0,class:"btn-icon",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none"},J={key:1,class:"btn-icon spinning",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none"},K={key:0,class:"breakdown-section"},X={class:"breakdown-grid"},Y={width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},aa=["d"],ea={class:"card-content"},oa={class:"card-label"},ta={class:"card-formula"},la={class:"card-value"},sa={class:"value-number"},na={class:"card-progress"},ra={key:0,class:"notes-section"},ia={class:"notes-content"},ca=x({__name:"FinalRankingCard",props:{showScoreInputs:{type:Boolean,default:!0},showSampleText:{type:Boolean,default:!0},showSave:{type:Boolean,default:!0},showCalculate:{type:Boolean,default:!0},initialScores:{type:Object,default:()=>({core:1,synonym_support:.95,domain_support:.9,application_support:.2})}},setup(x,{expose:ca}){const{success:ua,error:pa}=f(),da=x,va=a(!1),ha=a(null),ma=a(!1),ya=a(!1),ga={core:{label:"Core Score",color:"#007AFF"},synonym_support:{label:"Synonym Score",color:"#5856D6"},domain_support:{label:"Domain Score",color:"#FF9500"},application_support:{label:"Application Score",color:"#34C759"}},ka={core:{label:"Core Weight",color:"#007AFF"},synonym_support:{label:"Synonym Weight",color:"#5856D6"},domain_support:{label:"Domain Weight",color:"#FF9500"},application_support:{label:"Application Weight",color:"#34C759"}},wa=e(()=>({core:{label:"Core",color:"#007AFF",gradient:"linear-gradient(135deg, #007AFF, #5AC8FA)",icon:"M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5",defaultWeight:1,delay:"0ms"},synonym_support:{label:"Synonym",color:"#5856D6",gradient:"linear-gradient(135deg, #5856D6, #AF52DE)",icon:"M17 3a2.828 2.828 0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z",defaultWeight:.95,delay:"50ms"},domain_support:{label:"Domain",color:"#FF9500",gradient:"linear-gradient(135deg, #FF9500, #FF2D55)",icon:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z",defaultWeight:.9,delay:"100ms"},application_support:{label:"Application",color:"#34C759",gradient:"linear-gradient(135deg, #34C759, #30D158)",icon:"M22 11.08V12a10 10 0 11-5.93-9.14",defaultWeight:.2,delay:"150ms"}})),ba=a({core:1,synonym_support:.95,domain_support:.9,application_support:.2}),_a=a({core:1,synonym_support:.95,domain_support:.9,application_support:.2}),xa=a(""),fa=a(null);async function Fa(){ma.value=!0;try{await new Promise(a=>setTimeout(a,300)),fa.value=await async function(a,e={},o=""){const t=_||b;if(o&&o.trim())try{const a=(await t.post("/chat/respond",{message:o.trim()})).data;if(!(a?.alternatives&&a.alternatives.length>0))return{total:0,breakdown:{core:0,synonym_support:0,domain_support:0,application_support:0},weights:e,textFactor:0,notes:["ไม่พบคำตอบที่ตรงกับข้อความทดสอบ"]};{const o=a.alternatives[0],t=o.finalRanking||{};if(t&&t.breakdown&&"object"==typeof t.breakdown){const l={core:Number(t.breakdown.core??0),synonym_support:Number(t.breakdown.synonym_support??0),domain_support:Number(t.breakdown.domain_support??0),application_support:Number(t.breakdown.application_support??0)},s=Object.values(l).reduce((a,e)=>a+e,0),n=t.weights??{core:Number(e.core??1),synonym_support:Number(e.synonym_support??.95),domain_support:Number(e.domain_support??.9),application_support:Number(e.application_support??.2)},r=Number(t.score),i=Number.isFinite(r)?r.toFixed(3):s.toFixed(3);return{total:s,breakdown:l,weights:n,textFactor:1,notes:[`ค้นพบ: "${o.title||o.QuestionTitle||"N/A"}"`,`Score จาก chat: ${i}`],matchedQuestion:o.title||o.QuestionTitle,chatAlternatives:a.alternatives.slice(0,3)}}}}catch(r){}const l={scores:a,weights:e,sampleText:o},{data:s}=await t.post("/ranking/calculate",l);let n=s?.result||null;return n&&(n={...n,textFactor:n.textFactor??1,notes:n.notes||[]}),n}(_a.value,ba.value,xa.value||"")}finally{ma.value=!1}}function Ca(){ba.value.core=1,ba.value.synonym_support=.95,ba.value.domain_support=.9,ba.value.application_support=.2,Ma(),ua("โหลดค่ามาตรฐานแล้ว")}function Ma(){da.showCalculate||Fa()}async function Na(){try{const a=await async function(){const a=_||b,{data:e}=await a.get("/ranking/weights");return e?.weights}();a&&(ba.value.core=Number(a.core??ba.value.core),ba.value.synonym_support=Number(a.synonym_support??ba.value.synonym_support),ba.value.domain_support=Number(a.domain_support??ba.value.domain_support),ba.value.application_support=Number(a.application_support??ba.value.application_support)),Ma()}catch(a){}}async function Ba(){ya.value=!0;try{const a={core:ba.value.core,synonym_support:ba.value.synonym_support,domain_support:ba.value.domain_support,application_support:ba.value.application_support},e=await async function(a){const e=_||b,{data:o}=await e.post("/ranking/weights",a);return o}(a);if(e&&e.ok)ua("บันทึกค่าน้ำหนักเรียบร้อยแล้ว");else{const a=e&&e.message?e.message:e&&e.weights?"Saved (no message)":"Unknown error";pa("ไม่สามารถบันทึกได้: "+a)}}catch(a){const e=a?.response?.data?.message||a?.message||"เกิดข้อผิดพลาดขณะบันทึกค่าน้ำหนัก",o=a?.response?.status?" (status "+a.response.status+")":"";pa(e+o)}finally{ya.value=!1}}return o(()=>da.initialScores,a=>{a&&(_a.value={core:Number(a.core??_a.value.core),synonym_support:Number(a.synonym_support??_a.value.synonym_support),domain_support:Number(a.domain_support??_a.value.domain_support),application_support:Number(a.application_support??_a.value.application_support)})},{immediate:!0}),o(()=>({...ba.value,..._a.value}),()=>{Ma()},{deep:!0}),o(xa,()=>{xa.value.trim()&&Ma()}),t(async()=>{await Na()}),ca({reloadWeights:Na,resetToDefaults:async function(a){ba.value.core=Number(a.core),ba.value.synonym_support=Number(a.synonym_support),ba.value.domain_support=Number(a.domain_support),ba.value.application_support=Number(a.application_support),Ma()}}),(a,e)=>(s(),l("div",F,[n("div",{class:m(["ranking-card",{"is-calculating":ma.value}])},[n("div",C,[e[8]||(e[8]=r('<div class="header-left" data-v-a8741833><div class="icon-container" data-v-a8741833><svg class="check-icon" width="32" height="32" viewBox="0 0 24 24" fill="none" data-v-a8741833><circle class="circle-bg" cx="12" cy="12" r="10" data-v-a8741833></circle><circle class="circle-progress" cx="12" cy="12" r="10" data-v-a8741833></circle><path class="checkmark" d="M7 12.5L10.5 16L17 9" data-v-a8741833></path></svg></div><div class="title-group" data-v-a8741833><h5 class="card-title" data-v-a8741833>Final Ranking</h5><span class="card-subtitle" data-v-a8741833>คำนวณคะแนนการจัดอันดับ</span></div></div>',1)),n("div",M,[i(d,{name:"score-pop"},{default:c(()=>[fa.value?(s(),l("div",N,[e[5]||(e[5]=n("span",{class:"pill-label"},"Total",-1)),n("span",B,p(fa.value.total.toFixed(2)),1),e[6]||(e[6]=n("div",{class:"pill-glow"},null,-1))])):u("",!0)]),_:1}),i(d,{name:"score-pop"},{default:c(()=>[fa.value&&"number"==typeof fa.value.textFactor?(s(),l("div",S,[e[7]||(e[7]=n("span",{class:"pill-label"},"Text ×",-1)),n("span",L,p(Number(fa.value.textFactor).toFixed(2)),1)])):u("",!0)]),_:1})])]),n("div",A,[x.showSampleText?(s(),l("div",j,[e[9]||(e[9]=r('<div class="section-header" data-v-a8741833><svg class="section-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" data-v-a8741833><path d="M4 6h16M4 12h16M4 18h10" stroke="currentColor" stroke-width="2" stroke-linecap="round" data-v-a8741833></path></svg><span class="section-label" data-v-a8741833>ข้อความทดสอบ</span><span class="section-hint" data-v-a8741833>(ไม่บันทึก)</span></div>',1)),n("div",D,[v(n("textarea",{class:"apple-textarea",rows:"2",placeholder:"พิมพ์ข้อความ เช่น หอใน อยากได้หอพัก","onUpdate:modelValue":e[0]||(e[0]=a=>xa.value=a),onFocus:e[1]||(e[1]=a=>va.value=!0),onBlur:e[2]||(e[2]=a=>va.value=!1)},null,544),[[h,xa.value]]),n("div",{class:m(["textarea-border",{focused:va.value}])},null,2)])])):u("",!0),n("div",{class:m(["columns-container",{"single-column":!x.showScoreInputs}])},[x.showScoreInputs?(s(),l("div",V,[e[10]||(e[10]=r('<div class="column-header" data-v-a8741833><div class="column-icon blue-gradient" data-v-a8741833><svg width="16" height="16" viewBox="0 0 24 24" fill="none" data-v-a8741833><path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round" data-v-a8741833></path></svg></div><div data-v-a8741833><h6 class="column-title" data-v-a8741833>คะแนนจับคู่</h6><span class="column-subtitle" data-v-a8741833>0-1 ต่อเคส</span></div></div>',1)),n("div",W,[(s(),l(y,null,g(ga,(a,o)=>n("div",{class:"input-group",key:o},[n("label",T,[n("span",{class:"label-dot",style:w({background:a.color})},null,4),k(" "+p(a.label),1)]),n("div",z,[v(n("input",{type:"number",step:"0.01",min:"0",max:"1","onUpdate:modelValue":a=>_a.value[o]=a,class:"apple-input",onFocus:a=>ha.value=o,onBlur:e[3]||(e[3]=a=>ha.value=null)},null,40,U),[[h,_a.value[o],void 0,{number:!0}]]),n("div",{class:m(["input-ring",{active:ha.value===o}]),style:w({"--ring-color":a.color})},null,6)])])),64))]),e[11]||(e[11]=n("p",{class:"helper-text"},[n("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none"},[n("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"1.5"}),n("path",{d:"M12 16v-4M12 8h.01",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})]),k(" ใช้ปรับคะแนนรายคำ เช่น คำพ้องเหมือนมากให้ 0.95 ")],-1))])):u("",!0),n("div",H,[n("div",{class:"column-header"},[e[13]||(e[13]=r('<div class="column-icon purple-gradient" data-v-a8741833><svg width="16" height="16" viewBox="0 0 24 24" fill="none" data-v-a8741833><path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707" stroke="currentColor" stroke-width="2" stroke-linecap="round" data-v-a8741833></path></svg></div><div class="flex-grow-1" data-v-a8741833><h6 class="column-title" data-v-a8741833>ค่าน้ำหนัก</h6><span class="column-subtitle" data-v-a8741833>ปรับแล้วมีผลทั้งระบบ</span></div>',2)),n("button",{class:"preset-btn",onClick:Ca,title:"โหลดค่ามาตรฐาน"},[...e[12]||(e[12]=[n("svg",{class:"preset-icon",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},[n("path",{d:"M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"})],-1),n("span",null,"ค่ามาตรฐาน",-1)])])]),n("div",I,[(s(),l(y,null,g(ka,(a,o)=>n("div",{class:"input-group",key:o},[n("label",R,[n("span",{class:"label-dot",style:w({background:a.color})},null,4),k(" "+p(a.label),1)]),n("div",Q,[v(n("input",{type:"number",step:"0.01",min:"0",max:"2","onUpdate:modelValue":a=>ba.value[o]=a,class:"apple-input",onFocus:a=>ha.value="w_"+o,onBlur:e[4]||(e[4]=a=>ha.value=null)},null,40,O),[[h,ba.value[o],void 0,{number:!0}]]),n("div",{class:m(["input-ring",{active:ha.value==="w_"+o}]),style:w({"--ring-color":a.color})},null,6)])])),64))]),e[14]||(e[14]=n("p",{class:"helper-text"},[n("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none"},[n("path",{d:"M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z",stroke:"currentColor","stroke-width":"1.5"}),n("path",{d:"M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3M12 17h.01",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})]),k(" ค่านี้คือ global weight ใช้กับทุกคำถาม/คำตอบ ")],-1))])],2),n("div",$,[x.showCalculate?(s(),l("button",{key:0,class:"action-btn calculate-btn",onClick:Fa,disabled:ma.value},[ma.value?(s(),l("svg",G,[...e[16]||(e[16]=[n("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"2","stroke-dasharray":"31.4 31.4","stroke-linecap":"round"},null,-1)])])):(s(),l("svg",E,[...e[15]||(e[15]=[n("rect",{x:"4",y:"4",width:"16",height:"16",rx:"2",stroke:"currentColor","stroke-width":"2"},null,-1),n("path",{d:"M8 12h8M12 8v8",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round"},null,-1)])])),n("span",null,p(ma.value?"กำลังคำนวณ...":"คำนวณ Final Ranking"),1)],8,q)):u("",!0),x.showSave?(s(),l("button",{key:1,class:"action-btn save-btn",onClick:Ba,disabled:ya.value},[ya.value?(s(),l("svg",J,[...e[18]||(e[18]=[n("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"2","stroke-dasharray":"31.4 31.4","stroke-linecap":"round"},null,-1)])])):(s(),l("svg",Z,[...e[17]||(e[17]=[n("path",{d:"M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z",stroke:"currentColor","stroke-width":"2"},null,-1),n("polyline",{points:"17,21 17,13 7,13 7,21",stroke:"currentColor","stroke-width":"2"},null,-1),n("polyline",{points:"7,3 7,8 15,8",stroke:"currentColor","stroke-width":"2"},null,-1)])])),n("span",null,p(ya.value?"กำลังบันทึก...":"บันทึกค่า"),1)],8,P)):u("",!0)]),i(d,{name:"results-slide"},{default:c(()=>[fa.value?(s(),l("div",K,[e[19]||(e[19]=n("div",{class:"breakdown-header"},[n("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none"},[n("path",{d:"M3 3v18h18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}),n("path",{d:"M18 17V9M13 17V5M8 17v-3",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})]),n("span",null,"Breakdown")],-1)),n("div",X,[(s(!0),l(y,null,g(wa.value,(a,e)=>(s(),l("div",{key:e,class:"breakdown-card",style:w({"--card-color":a.color,"--delay":a.delay})},[n("div",{class:"card-icon",style:w({background:a.gradient})},[(s(),l("svg",Y,[n("path",{d:a.icon,stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},null,8,aa)]))],4),n("div",ea,[n("span",oa,p(a.label),1),n("span",ta,p(_a.value[e].toFixed(2))+" × "+p((fa.value.weights?.[e]??a.defaultWeight).toFixed(2)),1)]),n("div",la,[n("span",sa,p(fa.value.breakdown[e].toFixed(2)),1)]),n("div",na,[n("div",{class:"progress-bar",style:w({width:fa.value.breakdown[e]/fa.value.total*100+"%",background:a.gradient})},null,4)])],4))),128))])])):u("",!0)]),_:1}),i(d,{name:"fade"},{default:c(()=>[fa.value?.notes&&fa.value.notes.length?(s(),l("div",ra,[e[21]||(e[21]=n("div",{class:"notes-icon"},[n("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none"},[n("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z",stroke:"currentColor","stroke-width":"2"}),n("polyline",{points:"14,2 14,8 20,8",stroke:"currentColor","stroke-width":"2"}),n("line",{x1:"16",y1:"13",x2:"8",y2:"13",stroke:"currentColor","stroke-width":"2"}),n("line",{x1:"16",y1:"17",x2:"8",y2:"17",stroke:"currentColor","stroke-width":"2"})])],-1)),n("div",ia,[e[20]||(e[20]=n("strong",null,"Notes:",-1)),(s(!0),l(y,null,g(fa.value.notes,(a,e)=>(s(),l("span",{key:e},p(e>0?" • ":"")+p(a),1))),128))])])):u("",!0)]),_:1})])],2)]))}},[["__scopeId","data-v-a8741833"]]);export{ca as F};
